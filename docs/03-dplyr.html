<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 ggplot2作图入门 | 环境数据分析与可视化</title>
  <meta name="description" content="厦门大学环境与生态学院研究生课程" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 ggplot2作图入门 | 环境数据分析与可视化" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="厦门大学环境与生态学院研究生课程" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 ggplot2作图入门 | 环境数据分析与可视化" />
  
  <meta name="twitter:description" content="厦门大学环境与生态学院研究生课程" />
  

<meta name="author" content="谭巧国" />


<meta name="date" content="2022-06-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="01-intro.html"/>
<link rel="next" href="04-lubridate.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.23/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a></li>
<li class="chapter" data-level="1" data-path="01-intro.html"><a href="01-intro.html"><i class="fa fa-check"></i><b>1</b> R的基础知识</a>
<ul>
<li class="chapter" data-level="1.1" data-path="01-intro.html"><a href="01-intro.html#科学计算器"><i class="fa fa-check"></i><b>1.1</b> 科学计算器</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="01-intro.html"><a href="01-intro.html#取整"><i class="fa fa-check"></i><b>1.1.1</b> 取整</a></li>
<li class="chapter" data-level="1.1.2" data-path="01-intro.html"><a href="01-intro.html#保留有效数字"><i class="fa fa-check"></i><b>1.1.2</b> 保留有效数字</a></li>
<li class="chapter" data-level="1.1.3" data-path="01-intro.html"><a href="01-intro.html#常用运算符"><i class="fa fa-check"></i><b>1.1.3</b> 常用运算符</a></li>
<li class="chapter" data-level="1.1.4" data-path="01-intro.html"><a href="01-intro.html#逻辑运算"><i class="fa fa-check"></i><b>1.1.4</b> 逻辑运算</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="01-intro.html"><a href="01-intro.html#变量赋值"><i class="fa fa-check"></i><b>1.2</b> 变量赋值</a></li>
<li class="chapter" data-level="1.3" data-path="01-intro.html"><a href="01-intro.html#变量取名规则"><i class="fa fa-check"></i><b>1.3</b> 变量取名规则</a></li>
<li class="chapter" data-level="1.4" data-path="01-intro.html"><a href="01-intro.html#变量类型"><i class="fa fa-check"></i><b>1.4</b> 变量类型</a></li>
<li class="chapter" data-level="1.5" data-path="01-intro.html"><a href="01-intro.html#常用的数据类型"><i class="fa fa-check"></i><b>1.5</b> 常用的数据类型</a></li>
<li class="chapter" data-level="1.6" data-path="01-intro.html"><a href="01-intro.html#数据类型强制转化coercing"><i class="fa fa-check"></i><b>1.6</b> 数据类型强制转化（<code>coercing</code>）</a></li>
<li class="chapter" data-level="1.7" data-path="01-intro.html"><a href="01-intro.html#缺失值na和无穷大inf"><i class="fa fa-check"></i><b>1.7</b> 缺失值（<code>NA</code>）和无穷大（<code>Inf</code>）</a></li>
<li class="chapter" data-level="1.8" data-path="01-intro.html"><a href="01-intro.html#向量vector"><i class="fa fa-check"></i><b>1.8</b> 向量（vector）</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="01-intro.html"><a href="01-intro.html#用函数c-生成向量"><i class="fa fa-check"></i><b>1.8.1</b> 用函数<code>c( )</code>生成向量</a></li>
<li class="chapter" data-level="1.8.2" data-path="01-intro.html"><a href="01-intro.html#用-seq生成等差序列"><i class="fa fa-check"></i><b>1.8.2</b> 用 <code>seq()</code>生成等差序列</a></li>
<li class="chapter" data-level="1.8.3" data-path="01-intro.html"><a href="01-intro.html#用符号生成连续自然数序列"><i class="fa fa-check"></i><b>1.8.3</b> 用<code>:</code>符号生成连续自然数序列</a></li>
<li class="chapter" data-level="1.8.4" data-path="01-intro.html"><a href="01-intro.html#用rep重复元素生成向量"><i class="fa fa-check"></i><b>1.8.4</b> 用<strong><code>rep()</code></strong>重复元素，生成向量</a></li>
<li class="chapter" data-level="1.8.5" data-path="01-intro.html"><a href="01-intro.html#向量信息提取与运算"><i class="fa fa-check"></i><b>1.8.5</b> 向量信息提取与运算</a></li>
<li class="chapter" data-level="1.8.6" data-path="01-intro.html"><a href="01-intro.html#针对向量的统计运算"><i class="fa fa-check"></i><b>1.8.6</b> 针对向量的统计运算</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="01-intro.html"><a href="01-intro.html#矩阵matrix"><i class="fa fa-check"></i><b>1.9</b> 矩阵（matrix）</a>
<ul>
<li class="chapter" data-level="1.9.1" data-path="01-intro.html"><a href="01-intro.html#用matrix函数生成一个矩阵"><i class="fa fa-check"></i><b>1.9.1</b> 用<code>matrix()</code>函数生成一个矩阵</a></li>
</ul></li>
<li class="chapter" data-level="1.10" data-path="01-intro.html"><a href="01-intro.html#数据表data-frame"><i class="fa fa-check"></i><b>1.10</b> 数据表（data frame）</a>
<ul>
<li class="chapter" data-level="1.10.1" data-path="01-intro.html"><a href="01-intro.html#用data.frame函数生成一个数据表"><i class="fa fa-check"></i><b>1.10.1</b> 用<code>data.frame()</code>函数生成一个数据表</a></li>
<li class="chapter" data-level="1.10.2" data-path="01-intro.html"><a href="01-intro.html#引用data.frame中的信息"><i class="fa fa-check"></i><b>1.10.2</b> 引用<code>data.frame</code>中的信息</a></li>
<li class="chapter" data-level="1.10.3" data-path="01-intro.html"><a href="01-intro.html#查看base-r自带的数据"><i class="fa fa-check"></i><b>1.10.3</b> 查看base R自带的数据</a></li>
<li class="chapter" data-level="1.10.4" data-path="01-intro.html"><a href="01-intro.html#查看数据表的常用命令"><i class="fa fa-check"></i><b>1.10.4</b> 查看数据表的常用命令</a></li>
<li class="chapter" data-level="1.10.5" data-path="01-intro.html"><a href="01-intro.html#查看数据表的其他性质"><i class="fa fa-check"></i><b>1.10.5</b> 查看数据表的其他性质</a></li>
<li class="chapter" data-level="1.10.6" data-path="01-intro.html"><a href="01-intro.html#合并数据表"><i class="fa fa-check"></i><b>1.10.6</b> 合并数据表</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="01-intro.html"><a href="01-intro.html#读入数据"><i class="fa fa-check"></i><b>1.11</b> 读入数据</a></li>
<li class="chapter" data-level="1.12" data-path="01-intro.html"><a href="01-intro.html#输出数据"><i class="fa fa-check"></i><b>1.12</b> 输出数据</a></li>
<li class="chapter" data-level="1.13" data-path="01-intro.html"><a href="01-intro.html#base-r简单作图"><i class="fa fa-check"></i><b>1.13</b> Base R简单作图</a>
<ul>
<li class="chapter" data-level="1.13.1" data-path="01-intro.html"><a href="01-intro.html#默认的plot函数"><i class="fa fa-check"></i><b>1.13.1</b> 默认的<code>plot()</code>函数</a></li>
<li class="chapter" data-level="1.13.2" data-path="01-intro.html"><a href="01-intro.html#修改为折线图"><i class="fa fa-check"></i><b>1.13.2</b> 修改为折线图</a></li>
<li class="chapter" data-level="1.13.3" data-path="01-intro.html"><a href="01-intro.html#修改颜色设置"><i class="fa fa-check"></i><b>1.13.3</b> 修改颜色设置</a></li>
<li class="chapter" data-level="1.13.4" data-path="01-intro.html"><a href="01-intro.html#修改坐标轴名称"><i class="fa fa-check"></i><b>1.13.4</b> 修改坐标轴名称</a></li>
</ul></li>
<li class="chapter" data-level="1.14" data-path="01-intro.html"><a href="01-intro.html#ggplot作图"><i class="fa fa-check"></i><b>1.14</b> <code>ggplot</code>作图</a></li>
<li class="chapter" data-level="1.15" data-path="01-intro.html"><a href="01-intro.html#保存图片"><i class="fa fa-check"></i><b>1.15</b> 保存图片</a>
<ul>
<li class="chapter" data-level="1.15.1" data-path="01-intro.html"><a href="01-intro.html#第一种方法"><i class="fa fa-check"></i><b>1.15.1</b> 第一种方法</a></li>
</ul></li>
<li class="chapter" data-level="1.16" data-path="01-intro.html"><a href="01-intro.html#保存图片-1"><i class="fa fa-check"></i><b>1.16</b> 保存图片</a>
<ul>
<li class="chapter" data-level="1.16.1" data-path="01-intro.html"><a href="01-intro.html#第二种方法"><i class="fa fa-check"></i><b>1.16.1</b> 第二种方法</a></li>
<li class="chapter" data-level="1.16.2" data-path="01-intro.html"><a href="01-intro.html#推荐阅读"><i class="fa fa-check"></i><b>1.16.2</b> 推荐阅读</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="03-dplyr.html"><a href="03-dplyr.html"><i class="fa fa-check"></i><b>2</b> <code>ggplot2</code>作图入门</a>
<ul>
<li class="chapter" data-level="2.0.1" data-path="03-dplyr.html"><a href="03-dplyr.html#ggplot基本理念"><i class="fa fa-check"></i><b>2.0.1</b> ggplot基本理念</a></li>
<li class="chapter" data-level="2.1" data-path="03-dplyr.html"><a href="03-dplyr.html#以r自带的数据toothgrowth为例"><i class="fa fa-check"></i><b>2.1</b> 以R自带的数据<strong><code>ToothGrowth</code></strong>为例</a></li>
<li class="chapter" data-level="2.2" data-path="03-dplyr.html"><a href="03-dplyr.html#开始作图"><i class="fa fa-check"></i><b>2.2</b> 开始作图</a></li>
<li class="chapter" data-level="2.3" data-path="03-dplyr.html"><a href="03-dplyr.html#用颜色color区分不同处理"><i class="fa fa-check"></i><b>2.3</b> 用颜色”<strong><code>color=</code></strong>”区分不同处理</a></li>
<li class="chapter" data-level="2.4" data-path="03-dplyr.html"><a href="03-dplyr.html#用形状shape进一步区分不同处理"><i class="fa fa-check"></i><b>2.4</b> 用形状”<strong><code>shape=</code></strong>”进一步区分不同处理</a></li>
<li class="chapter" data-level="2.5" data-path="03-dplyr.html"><a href="03-dplyr.html#用stat_summary添加平均值"><i class="fa fa-check"></i><b>2.5</b> 用”<strong><code>stat_summary()</code></strong>”添加平均值</a></li>
<li class="chapter" data-level="2.6" data-path="03-dplyr.html"><a href="03-dplyr.html#用stat_summary添加平均值-1"><i class="fa fa-check"></i><b>2.6</b> 用”<strong><code>stat_summary()</code></strong>”添加平均值</a></li>
<li class="chapter" data-level="2.7" data-path="03-dplyr.html"><a href="03-dplyr.html#用stat_summary添加误差棒"><i class="fa fa-check"></i><b>2.7</b> 用”<strong><code>stat_summary()</code></strong>”添加误差棒</a></li>
<li class="chapter" data-level="2.8" data-path="03-dplyr.html"><a href="03-dplyr.html#用stat_summary添加误差棒-1"><i class="fa fa-check"></i><b>2.8</b> 用”<strong><code>stat_summary()</code></strong>”添加误差棒</a></li>
<li class="chapter" data-level="2.9" data-path="03-dplyr.html"><a href="03-dplyr.html#甚至是这样的"><i class="fa fa-check"></i><b>2.9</b> 甚至是这样的</a></li>
<li class="chapter" data-level="2.10" data-path="03-dplyr.html"><a href="03-dplyr.html#这样才是好的格式这叫tidy-data"><i class="fa fa-check"></i><b>2.10</b> 这样才是好的格式，这叫<strong>Tidy Data</strong></a></li>
<li class="chapter" data-level="2.11" data-path="03-dplyr.html"><a href="03-dplyr.html#tidy-data-整齐数据"><i class="fa fa-check"></i><b>2.11</b> Tidy Data 整齐数据</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="03-dplyr.html"><a href="03-dplyr.html#修改细节使之规范"><i class="fa fa-check"></i><b>2.11.1</b> 修改细节，使之规范</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="03-dplyr.html"><a href="03-dplyr.html#当然用均值标准差格式的数据也可以作图"><i class="fa fa-check"></i><b>2.12</b> 当然，用“均值+标准差”格式的数据也可以作图</a></li>
<li class="chapter" data-level="2.13" data-path="03-dplyr.html"><a href="03-dplyr.html#当然用均值标注差格式的数据也可以作图"><i class="fa fa-check"></i><b>2.13</b> 当然，用“均值+标注差”格式的数据也可以作图</a></li>
<li class="chapter" data-level="2.14" data-path="03-dplyr.html"><a href="03-dplyr.html#用geom_col画柱状图"><i class="fa fa-check"></i><b>2.14</b> 用<code>geom_col()</code>画柱状图</a>
<ul>
<li class="chapter" data-level="2.14.1" data-path="03-dplyr.html"><a href="03-dplyr.html#柱子的颜色用fill柱子的边框才是color"><i class="fa fa-check"></i><b>2.14.1</b> 柱子的颜色用<strong><code>fill</code></strong>，柱子的边框才是<strong><code>color</code></strong></a></li>
<li class="chapter" data-level="2.14.2" data-path="03-dplyr.html"><a href="03-dplyr.html#若有多组柱子需要dodge让他们错开否则默认stack堆叠"><i class="fa fa-check"></i><b>2.14.2</b> 若有多组柱子，需要<code>dodge</code>让他们错开，否则默认<code>stack</code>堆叠</a></li>
<li class="chapter" data-level="2.14.3" data-path="03-dplyr.html"><a href="03-dplyr.html#用position-position_dodge错开多组误差棒"><i class="fa fa-check"></i><b>2.14.3</b> 用<strong><code>position = position_dodge()</code></strong>，错开多组误差棒</a></li>
<li class="chapter" data-level="2.14.4" data-path="03-dplyr.html"><a href="03-dplyr.html#把x轴的dose变为factor类型使柱子之间等间隔"><i class="fa fa-check"></i><b>2.14.4</b> 把x轴的<code>dose</code>变为<code>factor</code>类型，使柱子之间等间隔</a></li>
</ul></li>
<li class="chapter" data-level="2.15" data-path="03-dplyr.html"><a href="03-dplyr.html#修改细节使之规范-1"><i class="fa fa-check"></i><b>2.15</b> 修改细节，使之规范</a></li>
<li class="chapter" data-level="2.16" data-path="03-dplyr.html"><a href="03-dplyr.html#直接用tidy-datatoothgrowth作柱状图"><i class="fa fa-check"></i><b>2.16</b> 直接用<code>Tidy Data</code>（<code>ToothGrowth</code>）作柱状图</a></li>
<li class="chapter" data-level="2.17" data-path="03-dplyr.html"><a href="03-dplyr.html#用geom_boxplot画箱式图"><i class="fa fa-check"></i><b>2.17</b> 用<code>geom_boxplot()</code>画箱式图</a></li>
<li class="chapter" data-level="2.18" data-path="03-dplyr.html"><a href="03-dplyr.html#用factor将数值变量转化为因子"><i class="fa fa-check"></i><b>2.18</b> 用<code>factor()</code>将数值变量转化为因子</a></li>
<li class="chapter" data-level="2.19" data-path="03-dplyr.html"><a href="03-dplyr.html#要点小结"><i class="fa fa-check"></i><b>2.19</b> 要点小结</a></li>
<li class="chapter" data-level="2.20" data-path="03-dplyr.html"><a href="03-dplyr.html#阅读作业"><i class="fa fa-check"></i><b>2.20</b> 阅读作业</a>
<ul>
<li class="chapter" data-level="2.20.1" data-path="03-dplyr.html"><a href="03-dplyr.html#hadley-wickham.-2016.-ggplot2-elegant-graphics-for-data-analysis."><i class="fa fa-check"></i><b>2.20.1</b> Hadley Wickham. 2016. ggplot2 Elegant Graphics for Data Analysis.</a></li>
</ul></li>
<li class="chapter" data-level="2.21" data-path="03-dplyr.html"><a href="03-dplyr.html#进阶拟合及结果可视化"><i class="fa fa-check"></i><b>2.21</b> 进阶：拟合及结果可视化</a></li>
<li class="chapter" data-level="2.22" data-path="03-dplyr.html"><a href="03-dplyr.html#先用head和str来查看数据"><i class="fa fa-check"></i><b>2.22</b> 先用<strong><code>head()</code></strong>和<strong><code>str()</code></strong>来查看数据</a></li>
<li class="chapter" data-level="2.23" data-path="03-dplyr.html"><a href="03-dplyr.html#散点图是我们对数据进行探索分析的法宝"><i class="fa fa-check"></i><b>2.23</b> 散点图是我们对数据进行探索分析的法宝</a></li>
<li class="chapter" data-level="2.24" data-path="03-dplyr.html"><a href="03-dplyr.html#均值标准差换一种方法"><i class="fa fa-check"></i><b>2.24</b> 均值+标准差（换一种方法）</a></li>
<li class="chapter" data-level="2.25" data-path="03-dplyr.html"><a href="03-dplyr.html#对比两种等价的作图方法"><i class="fa fa-check"></i><b>2.25</b> 对比两种等价的作图方法</a></li>
<li class="chapter" data-level="2.26" data-path="03-dplyr.html"><a href="03-dplyr.html#nls非线性拟合米氏方程手动提取拟合结果"><i class="fa fa-check"></i><b>2.26</b> <strong><code>nls()</code></strong>非线性拟合米氏方程：手动提取拟合结果</a></li>
<li class="chapter" data-level="2.27" data-path="03-dplyr.html"><a href="03-dplyr.html#nls非线性拟合米氏方程自动提取拟合结果-1"><i class="fa fa-check"></i><b>2.27</b> <strong><code>nls()</code></strong>非线性拟合米氏方程：自动提取拟合结果-1</a></li>
<li class="chapter" data-level="2.28" data-path="03-dplyr.html"><a href="03-dplyr.html#nls非线性拟合米氏方程自动提取拟合结果-2"><i class="fa fa-check"></i><b>2.28</b> <strong><code>nls()</code></strong>非线性拟合米氏方程：自动提取拟合结果-2</a></li>
<li class="chapter" data-level="2.29" data-path="03-dplyr.html"><a href="03-dplyr.html#生成画拟合线所需的数据"><i class="fa fa-check"></i><b>2.29</b> 生成画拟合线所需的数据</a></li>
<li class="chapter" data-level="2.30" data-path="03-dplyr.html"><a href="03-dplyr.html#添加拟合线"><i class="fa fa-check"></i><b>2.30</b> 添加拟合线</a></li>
<li class="chapter" data-level="2.31" data-path="03-dplyr.html"><a href="03-dplyr.html#修饰细节"><i class="fa fa-check"></i><b>2.31</b> 修饰细节</a></li>
<li class="chapter" data-level="2.32" data-path="03-dplyr.html"><a href="03-dplyr.html#如何在图上添加数学公式"><i class="fa fa-check"></i><b>2.32</b> 如何在图上添加数学公式？</a></li>
<li class="chapter" data-level="2.33" data-path="03-dplyr.html"><a href="03-dplyr.html#另一个探索数据的超级武器分面facet"><i class="fa fa-check"></i><b>2.33</b> 另一个探索数据的超级武器：分面<strong><code>facet</code></strong></a></li>
<li class="chapter" data-level="2.34" data-path="03-dplyr.html"><a href="03-dplyr.html#运用for循环语句批量拟合11组数据"><i class="fa fa-check"></i><b>2.34</b> 运用<code>for()</code>循环语句，批量拟合11组数据</a></li>
<li class="chapter" data-level="2.35" data-path="03-dplyr.html"><a href="03-dplyr.html#生成画11条拟合线的数据"><i class="fa fa-check"></i><b>2.35</b> 生成画11条拟合线的数据</a></li>
<li class="chapter" data-level="2.36" data-path="03-dplyr.html"><a href="03-dplyr.html#画11条拟合线"><i class="fa fa-check"></i><b>2.36</b> 画11条拟合线</a></li>
<li class="chapter" data-level="2.37" data-path="03-dplyr.html"><a href="03-dplyr.html#修改细节"><i class="fa fa-check"></i><b>2.37</b> 修改细节</a></li>
<li class="chapter" data-level="2.38" data-path="03-dplyr.html"><a href="03-dplyr.html#目前的数据存在哪些问题"><i class="fa fa-check"></i><b>2.38</b> 目前的数据存在哪些问题：</a>
<ul>
<li class="chapter" data-level="2.38.1" data-path="03-dplyr.html"><a href="03-dplyr.html#数据太大冗余信息过多"><i class="fa fa-check"></i><b>2.38.1</b> 1. 数据太大，冗余信息过多</a></li>
<li class="chapter" data-level="2.38.2" data-path="03-dplyr.html"><a href="03-dplyr.html#存在干重湿重两种不同的单位"><i class="fa fa-check"></i><b>2.38.2</b> 2. 存在干重、湿重两种不同的单位</a></li>
</ul></li>
<li class="chapter" data-level="2.39" data-path="03-dplyr.html"><a href="03-dplyr.html#整理数据用select筛选数据的特定列"><i class="fa fa-check"></i><b>2.39</b> 整理数据：用<code>select()</code>筛选数据的特定列</a>
<ul>
<li class="chapter" data-level="2.39.1" data-path="03-dplyr.html"><a href="03-dplyr.html#使用列名来选择列"><i class="fa fa-check"></i><b>2.39.1</b> 使用“列名”来选择列</a></li>
<li class="chapter" data-level="2.39.2" data-path="03-dplyr.html"><a href="03-dplyr.html#也可以用列号进行选择"><i class="fa fa-check"></i><b>2.39.2</b> 也可以用“列号”进行选择</a></li>
</ul></li>
<li class="chapter" data-level="2.40" data-path="03-dplyr.html"><a href="03-dplyr.html#数据整理-用filter筛选数据的特定行"><i class="fa fa-check"></i><b>2.40</b> 数据整理： 用<code>filter()</code>筛选数据的特定行</a>
<ul>
<li class="chapter" data-level="2.40.1" data-path="03-dplyr.html"><a href="03-dplyr.html#筛选出牡蛎和贻贝的数据"><i class="fa fa-check"></i><b>2.40.1</b> 筛选出牡蛎和贻贝的数据</a></li>
<li class="chapter" data-level="2.40.2" data-path="03-dplyr.html"><a href="03-dplyr.html#检查一下新的数据"><i class="fa fa-check"></i><b>2.40.2</b> 检查一下新的数据</a></li>
<li class="chapter" data-level="2.40.3" data-path="03-dplyr.html"><a href="03-dplyr.html#再次查看数据的单位"><i class="fa fa-check"></i><b>2.40.3</b> 再次查看数据的单位</a></li>
<li class="chapter" data-level="2.40.4" data-path="03-dplyr.html"><a href="03-dplyr.html#也可以用base-r的subset筛选数据"><i class="fa fa-check"></i><b>2.40.4</b> 也可以用base R的<code>subset()</code>筛选数据</a></li>
</ul></li>
<li class="chapter" data-level="2.41" data-path="03-dplyr.html"><a href="03-dplyr.html#注意区分filter和select"><i class="fa fa-check"></i><b>2.41</b> 注意区分<code>filter()</code>和<code>select()</code></a>
<ul>
<li class="chapter" data-level="2.41.1" data-path="03-dplyr.html"><a href="03-dplyr.html#筛选出cd的数据"><i class="fa fa-check"></i><b>2.41.1</b> 筛选出Cd的数据</a></li>
<li class="chapter" data-level="2.41.2" data-path="03-dplyr.html"><a href="03-dplyr.html#可以作个图看看数据了"><i class="fa fa-check"></i><b>2.41.2</b> 可以作个图看看数据了</a></li>
<li class="chapter" data-level="2.41.3" data-path="03-dplyr.html"><a href="03-dplyr.html#去掉只有2个数据点的物种"><i class="fa fa-check"></i><b>2.41.3</b> 去掉只有2个数据点的物种</a></li>
<li class="chapter" data-level="2.41.4" data-path="03-dplyr.html"><a href="03-dplyr.html#研究问题1牡蛎贻贝谁的cd浓度高"><i class="fa fa-check"></i><b>2.41.4</b> 研究问题1：牡蛎、贻贝，谁的Cd浓度高？</a></li>
<li class="chapter" data-level="2.41.5" data-path="03-dplyr.html"><a href="03-dplyr.html#按中位值排序"><i class="fa fa-check"></i><b>2.41.5</b> 按中位值排序</a></li>
<li class="chapter" data-level="2.41.6" data-path="03-dplyr.html"><a href="03-dplyr.html#按中位值排序-1"><i class="fa fa-check"></i><b>2.41.6</b> 按中位值排序</a></li>
<li class="chapter" data-level="2.41.7" data-path="03-dplyr.html"><a href="03-dplyr.html#修饰细节-1"><i class="fa fa-check"></i><b>2.41.7</b> 修饰细节</a></li>
</ul></li>
<li class="chapter" data-level="2.42" data-path="03-dplyr.html"><a href="03-dplyr.html#用group_by和summarise分组计算均值标准差"><i class="fa fa-check"></i><b>2.42</b> 用<code>group_by</code>和<code>summarise</code>分组计算均值、标准差</a></li>
<li class="chapter" data-level="2.43" data-path="03-dplyr.html"><a href="03-dplyr.html#研究问题2"><i class="fa fa-check"></i><b>2.43</b> 研究问题2：</a>
<ul>
<li class="chapter" data-level="2.43.1" data-path="03-dplyr.html"><a href="03-dplyr.html#zn浓度高的牡蛎是否cd浓度也高"><i class="fa fa-check"></i><b>2.43.1</b> Zn浓度高的牡蛎，是否Cd浓度也高？</a></li>
<li class="chapter" data-level="2.43.2" data-path="03-dplyr.html"><a href="03-dplyr.html#整理数据"><i class="fa fa-check"></i><b>2.43.2</b> 整理数据</a></li>
<li class="chapter" data-level="2.43.3" data-path="03-dplyr.html"><a href="03-dplyr.html#查看整理好的数据"><i class="fa fa-check"></i><b>2.43.3</b> 查看整理好的数据</a></li>
<li class="chapter" data-level="2.43.4" data-path="03-dplyr.html"><a href="03-dplyr.html#把数据切分成cd数据zn数据"><i class="fa fa-check"></i><b>2.43.4</b> 把数据切分成<code>Cd</code>数据、<code>Zn</code>数据</a></li>
<li class="chapter" data-level="2.43.5" data-path="03-dplyr.html"><a href="03-dplyr.html#运用inner_join合并两套数据"><i class="fa fa-check"></i><b>2.43.5</b> 运用<code>inner_join()</code>合并两套数据</a></li>
<li class="chapter" data-level="2.43.6" data-path="03-dplyr.html"><a href="03-dplyr.html#join系列函数"><i class="fa fa-check"></i><b>2.43.6</b> <code>join</code>系列函数</a></li>
<li class="chapter" data-level="2.43.7" data-path="03-dplyr.html"><a href="03-dplyr.html#作散点图初步了解数据"><i class="fa fa-check"></i><b>2.43.7</b> 作散点图初步了解数据</a></li>
<li class="chapter" data-level="2.43.8" data-path="03-dplyr.html"><a href="03-dplyr.html#使用双对数坐标"><i class="fa fa-check"></i><b>2.43.8</b> 使用双对数坐标</a></li>
<li class="chapter" data-level="2.43.9" data-path="03-dplyr.html"><a href="03-dplyr.html#按不同物种分面作图"><i class="fa fa-check"></i><b>2.43.9</b> 按不同物种分面作图</a></li>
<li class="chapter" data-level="2.43.10" data-path="03-dplyr.html"><a href="03-dplyr.html#添加拟合线帮助判断趋势"><i class="fa fa-check"></i><b>2.43.10</b> 添加拟合线，帮助判断趋势</a></li>
<li class="chapter" data-level="2.43.11" data-path="03-dplyr.html"><a href="03-dplyr.html#美化一下"><i class="fa fa-check"></i><b>2.43.11</b> 美化一下</a></li>
<li class="chapter" data-level="2.43.12" data-path="03-dplyr.html"><a href="03-dplyr.html#成品"><i class="fa fa-check"></i><b>2.43.12</b> 成品</a></li>
</ul></li>
<li class="chapter" data-level="2.44" data-path="03-dplyr.html"><a href="03-dplyr.html#要点小结-1"><i class="fa fa-check"></i><b>2.44</b> 要点小结</a></li>
<li class="chapter" data-level="2.45" data-path="03-dplyr.html"><a href="03-dplyr.html#要点小结-2"><i class="fa fa-check"></i><b>2.45</b> 要点小结</a>
<ul>
<li class="chapter" data-level="2.45.1" data-path="03-dplyr.html"><a href="03-dplyr.html#运算符"><i class="fa fa-check"></i><b>2.45.1</b> “<code>%&gt;%</code>”运算符</a></li>
</ul></li>
<li class="chapter" data-level="2.46" data-path="03-dplyr.html"><a href="03-dplyr.html#练习"><i class="fa fa-check"></i><b>2.46</b> 练习</a></li>
<li class="chapter" data-level="2.47" data-path="03-dplyr.html"><a href="03-dplyr.html#阅读"><i class="fa fa-check"></i><b>2.47</b> 阅读：</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="04-lubridate.html"><a href="04-lubridate.html"><i class="fa fa-check"></i><b>3</b> <code>lubridate</code>处理时间数据</a>
<ul>
<li class="chapter" data-level="3.1" data-path="04-lubridate.html"><a href="04-lubridate.html#时间格式转化"><i class="fa fa-check"></i><b>3.1</b> 时间格式转化</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="04-lubridate.html"><a href="04-lubridate.html#字符串转化为日期date格式"><i class="fa fa-check"></i><b>3.1.1</b> 字符串转化为日期（<code>Date</code>）格式</a></li>
<li class="chapter" data-level="3.1.2" data-path="04-lubridate.html"><a href="04-lubridate.html#字符串转化为日期date格式-1"><i class="fa fa-check"></i><b>3.1.2</b> 字符串转化为日期（<code>Date</code>）格式</a></li>
<li class="chapter" data-level="3.1.3" data-path="04-lubridate.html"><a href="04-lubridate.html#字符串转化为日期-时间date-time格式"><i class="fa fa-check"></i><b>3.1.3</b> 字符串转化为日期-时间（<code>date-time</code>）格式</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="04-lubridate.html"><a href="04-lubridate.html#时间信息提取"><i class="fa fa-check"></i><b>3.2</b> 时间信息提取</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="04-lubridate.html"><a href="04-lubridate.html#提取日期数据中的信息"><i class="fa fa-check"></i><b>3.2.1</b> 提取日期数据中的信息</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="04-lubridate.html"><a href="04-lubridate.html#提取日期-时间数据中的信息"><i class="fa fa-check"></i><b>3.3</b> 提取日期-时间数据中的信息</a></li>
<li class="chapter" data-level="3.4" data-path="04-lubridate.html"><a href="04-lubridate.html#时区"><i class="fa fa-check"></i><b>3.4</b> 时区</a></li>
<li class="chapter" data-level="3.5" data-path="04-lubridate.html"><a href="04-lubridate.html#时区-1"><i class="fa fa-check"></i><b>3.5</b> 时区</a></li>
<li class="chapter" data-level="3.6" data-path="04-lubridate.html"><a href="04-lubridate.html#时间计算"><i class="fa fa-check"></i><b>3.6</b> 时间计算</a></li>
<li class="chapter" data-level="3.7" data-path="04-lubridate.html"><a href="04-lubridate.html#时间数据可视化"><i class="fa fa-check"></i><b>3.7</b> 时间数据可视化</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="04-lubridate.html"><a href="04-lubridate.html#厦门空气质量数据分析"><i class="fa fa-check"></i><b>3.7.1</b> 厦门空气质量数据分析</a></li>
<li class="chapter" data-level="3.7.2" data-path="04-lubridate.html"><a href="04-lubridate.html#年厦门pm2.5逐日变化趋势"><i class="fa fa-check"></i><b>3.7.2</b> 2021年厦门PM2.5逐日变化趋势</a></li>
<li class="chapter" data-level="3.7.3" data-path="04-lubridate.html"><a href="04-lubridate.html#年厦门pm2.5逐日变化趋势调整细节"><i class="fa fa-check"></i><b>3.7.3</b> 2021年厦门PM2.5逐日变化趋势：调整细节</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="04-lubridate.html"><a href="04-lubridate.html#strptime查看日期时间格式"><i class="fa fa-check"></i><b>3.8</b> <code>?strptime</code>查看日期时间格式</a></li>
<li class="chapter" data-level="3.9" data-path="04-lubridate.html"><a href="04-lubridate.html#合并四年数据用于分析"><i class="fa fa-check"></i><b>3.9</b> 合并四年数据用于分析</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="04-lubridate.html"><a href="04-lubridate.html#了解合并数据的结构尤其是数据类型"><i class="fa fa-check"></i><b>3.9.1</b> 了解合并数据的结构，尤其是数据类型</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="04-lubridate.html"><a href="04-lubridate.html#数据整理"><i class="fa fa-check"></i><b>3.10</b> 数据整理</a></li>
<li class="chapter" data-level="3.11" data-path="04-lubridate.html"><a href="04-lubridate.html#缺哪天的数据"><i class="fa fa-check"></i><b>3.11</b> 缺哪天的数据？</a></li>
<li class="chapter" data-level="3.12" data-path="04-lubridate.html"><a href="04-lubridate.html#总体趋势厦门aqi的4年趋势"><i class="fa fa-check"></i><b>3.12</b> 总体趋势：厦门AQI的4年趋势</a></li>
<li class="chapter" data-level="3.13" data-path="04-lubridate.html"><a href="04-lubridate.html#总体趋势一并查看6项指标"><i class="fa fa-check"></i><b>3.13</b> 总体趋势：一并查看6项指标</a></li>
<li class="chapter" data-level="3.14" data-path="04-lubridate.html"><a href="04-lubridate.html#细看季节趋势pm2.5"><i class="fa fa-check"></i><b>3.14</b> 细看季节趋势：PM2.5</a></li>
<li class="chapter" data-level="3.15" data-path="04-lubridate.html"><a href="04-lubridate.html#细看各个月份各月份的pm2.5概率密度分布"><i class="fa fa-check"></i><b>3.15</b> 细看各个月份：各月份的PM2.5概率密度分布</a></li>
<li class="chapter" data-level="3.16" data-path="04-lubridate.html"><a href="04-lubridate.html#对比各月份与总体的pm2.5概率密度分布"><i class="fa fa-check"></i><b>3.16</b> 对比各月份与总体的PM2.5概率密度分布</a></li>
<li class="chapter" data-level="3.17" data-path="04-lubridate.html"><a href="04-lubridate.html#对比各月份与总体的pm2.5概率密度分布-1"><i class="fa fa-check"></i><b>3.17</b> 对比各月份与总体的PM2.5概率密度分布</a></li>
<li class="chapter" data-level="3.18" data-path="04-lubridate.html"><a href="04-lubridate.html#季节趋势总览全部参数"><i class="fa fa-check"></i><b>3.18</b> 季节趋势：总览全部参数</a></li>
<li class="chapter" data-level="3.19" data-path="04-lubridate.html"><a href="04-lubridate.html#工作日-周末趋势pm2.5"><i class="fa fa-check"></i><b>3.19</b> 工作日-周末趋势：PM2.5</a></li>
<li class="chapter" data-level="3.20" data-path="04-lubridate.html"><a href="04-lubridate.html#昼夜趋势臭氧"><i class="fa fa-check"></i><b>3.20</b> 昼夜趋势：臭氧</a></li>
<li class="chapter" data-level="3.21" data-path="04-lubridate.html"><a href="04-lubridate.html#昼夜趋势臭氧-1"><i class="fa fa-check"></i><b>3.21</b> 昼夜趋势：臭氧</a></li>
<li class="chapter" data-level="3.22" data-path="04-lubridate.html"><a href="04-lubridate.html#昼夜趋势臭氧-2"><i class="fa fa-check"></i><b>3.22</b> 昼夜趋势：臭氧</a></li>
<li class="chapter" data-level="3.23" data-path="04-lubridate.html"><a href="04-lubridate.html#拓展阅读"><i class="fa fa-check"></i><b>3.23</b> 拓展阅读</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="05-map.html"><a href="05-map.html"><i class="fa fa-check"></i><b>4</b> 绘制地图</a></li>
<li class="chapter" data-level="5" data-path="06-correlation.html"><a href="06-correlation.html"><i class="fa fa-check"></i><b>5</b> 相关性分析</a></li>
<li class="chapter" data-level="6" data-path="07-mlr.html"><a href="07-mlr.html"><i class="fa fa-check"></i><b>6</b> 线性回归</a></li>
<li class="chapter" data-level="7" data-path="08-logistic.html"><a href="08-logistic.html"><i class="fa fa-check"></i><b>7</b> Logistic回归</a></li>
<li class="chapter" data-level="8" data-path="09-ttest.html"><a href="09-ttest.html"><i class="fa fa-check"></i><b>8</b> <em>t</em>检验</a></li>
<li class="chapter" data-level="9" data-path="10-anova.html"><a href="10-anova.html"><i class="fa fa-check"></i><b>9</b> 单因素方差分析</a></li>
<li class="chapter" data-level="10" data-path="11-2wayanova.html"><a href="11-2wayanova.html"><i class="fa fa-check"></i><b>10</b> 多因素方差分析</a></li>
<li class="chapter" data-level="11" data-path="12-ancova.html"><a href="12-ancova.html"><i class="fa fa-check"></i><b>11</b> 协方差分析</a></li>
<li class="chapter" data-level="12" data-path="13-pca.html"><a href="13-pca.html"><i class="fa fa-check"></i><b>12</b> 主成分分析</a></li>
<li class="chapter" data-level="" data-path="14-reference.html"><a href="14-reference.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">环境数据分析与可视化</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot2作图入门" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> <code>ggplot2</code>作图入门<a href="03-dplyr.html#ggplot2作图入门" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="ggplot基本理念" class="section level3 hasAnchor" number="2.0.1">
<h3><span class="header-section-number">2.0.1</span> ggplot基本理念<a href="03-dplyr.html#ggplot基本理念" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>图层、映射</p>
<p>展开画布，一张空图</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="03-dplyr.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb198-2"><a href="03-dplyr.html#cb198-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-3"><a href="03-dplyr.html#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<p>数据有了，但还不知道要画什么图，仍然是一张空图</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="03-dplyr.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<p>知道了谁是<code>x</code></p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="03-dplyr.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg)<span class="sc">+</span></span>
<span id="cb200-2"><a href="03-dplyr.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> displ)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<p>知道了谁是<code>y</code></p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="03-dplyr.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg)<span class="sc">+</span></span>
<span id="cb201-2"><a href="03-dplyr.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> displ)<span class="sc">+</span></span>
<span id="cb201-3"><a href="03-dplyr.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> hwy)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<p>知道了要画什么图，图就有了</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="03-dplyr.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg)<span class="sc">+</span></span>
<span id="cb202-2"><a href="03-dplyr.html#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> displ)<span class="sc">+</span></span>
<span id="cb202-3"><a href="03-dplyr.html#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> hwy) <span class="sc">+</span></span>
<span id="cb202-4"><a href="03-dplyr.html#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<p>把<code>aes()</code>收进<code>ggplot()</code>，代码显得紧凑</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="03-dplyr.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))<span class="sc">+</span></span>
<span id="cb203-2"><a href="03-dplyr.html#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<p>颜色映射到变量<code>class</code>，</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="03-dplyr.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> class))<span class="sc">+</span></span>
<span id="cb204-2"><a href="03-dplyr.html#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<p>颜色映射放在ggplot里，会管住所有图层</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="03-dplyr.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> class))<span class="sc">+</span></span>
<span id="cb205-2"><a href="03-dplyr.html#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb205-3"><a href="03-dplyr.html#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>颜色映射放在<code>geom_point()</code>里，只能管住<code>geom_point()</code>图层，对其他图层不起作用</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="03-dplyr.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))<span class="sc">+</span></span>
<span id="cb207-2"><a href="03-dplyr.html#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> class))</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="03-dplyr.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))<span class="sc">+</span></span>
<span id="cb208-2"><a href="03-dplyr.html#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> class))<span class="sc">+</span></span>
<span id="cb208-3"><a href="03-dplyr.html#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-70-2.png" width="672" /></p>
</div>
<div id="以r自带的数据toothgrowth为例" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> 以R自带的数据<strong><code>ToothGrowth</code></strong>为例<a href="03-dplyr.html#以r自带的数据toothgrowth为例" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>先用敲入代码<strong><code>?ToothGrowth</code></strong>来了解一下数据。
&gt;The Effect of Vitamin C on Tooth Growth in Guinea Pigs (豚鼠)<br />
&gt; Description<br />
&gt; The response is the length of odontoblasts (cells responsible for tooth growth) in 60 guinea pigs. Each animal received one of three dose levels of vitamin C (0.5, 1, and 2 mg/day) by one of two delivery methods, orange juice or ascorbic acid (a form of vitamin C and coded as VC).</p>
<blockquote>
<p>Format<br />
A data frame with 60 observations on 3 variables.</p>
</blockquote>
<blockquote>
<p>[,1] len numeric Tooth length .red[第1列是数值变量，牙齿长度]<br />
[,2] supp factor Supplement type (VC or OJ) .red[第2列是因子，补充剂类型，维C还是橙汁]<br />
[,3] dose numeric Dose in milligrams/day .red[第3列是数值变量，补充剂的剂量]</p>
</blockquote>
<blockquote>
<p>References
Crampton, E. W. (1947). The growth of the odontoblast of the incisor teeth as a criterion of vitamin C intake of the guinea pig. The Journal of Nutrition, 33(5), 491–504. doi: 10.1093/jn/33.5.491.</p>
</blockquote>
<hr />
<p>##了解一下<strong><code>ToothGrowth</code></strong>的内容</p>
<p>先用<strong><code>head()</code></strong>来看看数据长什么样：</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="03-dplyr.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ToothGrowth)</span></code></pre></div>
<pre><code>##    len supp dose
## 1  4.2   VC  0.5
## 2 11.5   VC  0.5
## 3  7.3   VC  0.5
## 4  5.8   VC  0.5
## 5  6.4   VC  0.5
## 6 10.0   VC  0.5</code></pre>
<p>再用<strong><code>str()</code></strong>具体了解一下数据概况：</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="03-dplyr.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ToothGrowth)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    60 obs. of  3 variables:
##  $ len : num  4.2 11.5 7.3 5.8 6.4 10 11.2 11.2 5.2 7 ...
##  $ supp: Factor w/ 2 levels &quot;OJ&quot;,&quot;VC&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ dose: num  0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...</code></pre>
<hr />
</div>
<div id="开始作图" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> 开始作图<a href="03-dplyr.html#开始作图" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>使用<code>ggplot()</code>作图，需先加载<code>ggplot2</code>程序包<br />
</li>
<li>可以略去“<code>x=</code>”，“<code>y=</code>”，使代码更简洁；第1个数默认给x，第2个默认给y</li>
</ul>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="03-dplyr.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co">#加载ggplot2包</span></span>
<span id="cb214-2"><a href="03-dplyr.html#cb214-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-3"><a href="03-dplyr.html#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len))<span class="sc">+</span></span>
<span id="cb214-4"><a href="03-dplyr.html#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="03-dplyr.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co">#简洁代码：</span></span>
<span id="cb215-2"><a href="03-dplyr.html#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(dose, len))<span class="sc">+</span></span>
<span id="cb215-3"><a href="03-dplyr.html#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="用颜色color区分不同处理" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> 用颜色”<strong><code>color=</code></strong>”区分不同处理<a href="03-dplyr.html#用颜色color区分不同处理" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>将颜色（<code>color</code>）映射（mapping）到补充剂类别（<code>supp</code>）上，即用不同颜色区分“VC”和“橙汁”数据</li>
</ul>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="03-dplyr.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len, <span class="at">color=</span>supp))<span class="sc">+</span></span>
<span id="cb216-2"><a href="03-dplyr.html#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()  </span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
</div>
<div id="用形状shape进一步区分不同处理" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> 用形状”<strong><code>shape=</code></strong>”进一步区分不同处理<a href="03-dplyr.html#用形状shape进一步区分不同处理" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>将点的形状映射到补充剂类别上，即用不同形状区分“VC”和“橙汁”数据<br />
</li>
<li>黑白打印、色盲友好</li>
</ul>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="03-dplyr.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len, <span class="at">color=</span>supp,<span class="at">shape=</span>supp))<span class="sc">+</span></span>
<span id="cb217-2"><a href="03-dplyr.html#cb217-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()  </span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
</div>
<div id="用stat_summary添加平均值" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> 用”<strong><code>stat_summary()</code></strong>”添加平均值<a href="03-dplyr.html#用stat_summary添加平均值" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>我们喜欢看平均值</li>
</ul>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="03-dplyr.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len, </span>
<span id="cb218-2"><a href="03-dplyr.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="at">color=</span>supp, <span class="at">shape=</span>supp))<span class="sc">+</span></span>
<span id="cb218-3"><a href="03-dplyr.html#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb218-4"><a href="03-dplyr.html#cb218-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;line&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-77-1.png" width="672" />
]</p>
</div>
<div id="用stat_summary添加平均值-1" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> 用”<strong><code>stat_summary()</code></strong>”添加平均值<a href="03-dplyr.html#用stat_summary添加平均值-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>去掉散点，加上平均值对应的点</li>
</ul>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="03-dplyr.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len, </span>
<span id="cb219-2"><a href="03-dplyr.html#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="at">color=</span>supp, <span class="at">shape=</span>supp))<span class="sc">+</span></span>
<span id="cb219-3"><a href="03-dplyr.html#cb219-3" aria-hidden="true" tabindex="-1"></a> <span class="co">#geom_point()+ #加上井号的作用：使这行代码变为注释，不运行</span></span>
<span id="cb219-4"><a href="03-dplyr.html#cb219-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;line&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)<span class="sc">+</span></span>
<span id="cb219-5"><a href="03-dplyr.html#cb219-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;point&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<hr />
</div>
<div id="用stat_summary添加误差棒" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> 用”<strong><code>stat_summary()</code></strong>”添加误差棒<a href="03-dplyr.html#用stat_summary添加误差棒" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>计算标准差的函数是<code>sd()</code>；误差棒：<code>errorbar</code></li>
</ul>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="03-dplyr.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len, </span>
<span id="cb220-2"><a href="03-dplyr.html#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="at">color=</span>supp, <span class="at">shape=</span>supp))<span class="sc">+</span></span>
<span id="cb220-3"><a href="03-dplyr.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;line&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)<span class="sc">+</span></span>
<span id="cb220-4"><a href="03-dplyr.html#cb220-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;point&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)<span class="sc">+</span></span>
<span id="cb220-5"><a href="03-dplyr.html#cb220-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;errorbar&quot;</span>, <span class="at">fun.min=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">-</span><span class="fu">sd</span>(x),          <span class="at">fun.max=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">+</span><span class="fu">sd</span>(x)) <span class="co">#自定义函数计算标准差；还有很多其他方法，目前这个方法最容易理解</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
</div>
<div id="用stat_summary添加误差棒-1" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> 用”<strong><code>stat_summary()</code></strong>”添加误差棒<a href="03-dplyr.html#用stat_summary添加误差棒-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>美化一下误差棒</li>
</ul>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="03-dplyr.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len, </span>
<span id="cb221-2"><a href="03-dplyr.html#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="at">color=</span>supp, <span class="at">shape=</span>supp))<span class="sc">+</span></span>
<span id="cb221-3"><a href="03-dplyr.html#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;line&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)<span class="sc">+</span></span>
<span id="cb221-4"><a href="03-dplyr.html#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;point&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)<span class="sc">+</span></span>
<span id="cb221-5"><a href="03-dplyr.html#cb221-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;errorbar&quot;</span>, <span class="at">fun.min=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">-</span><span class="fu">sd</span>(x), <span class="at">fun.max=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">+</span><span class="fu">sd</span>(x), <span class="at">width=</span><span class="fl">0.1</span>) <span class="co">#把误差棒变窄，试试改为0</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>我的数据不是这种格式啊!</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
supp
</th>
<th style="text-align:right;">
dose
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
OJ
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
13.23
</td>
<td style="text-align:right;">
4.46
</td>
</tr>
<tr>
<td style="text-align:left;">
OJ
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
22.70
</td>
<td style="text-align:right;">
3.91
</td>
</tr>
<tr>
<td style="text-align:left;">
OJ
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
26.06
</td>
<td style="text-align:right;">
2.66
</td>
</tr>
<tr>
<td style="text-align:left;">
VC
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
7.98
</td>
<td style="text-align:right;">
2.75
</td>
</tr>
<tr>
<td style="text-align:left;">
VC
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
16.77
</td>
<td style="text-align:right;">
2.52
</td>
</tr>
<tr>
<td style="text-align:left;">
VC
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
26.14
</td>
<td style="text-align:right;">
4.80
</td>
</tr>
</tbody>
</table>
</div>
<div id="甚至是这样的" class="section level2 hasAnchor" number="2.9">
<h2><span class="header-section-number">2.9</span> 甚至是这样的<a href="03-dplyr.html#甚至是这样的" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<thead>
<tr>
<th style="text-align:left;">
supp…1
</th>
<th style="text-align:right;">
dose…2
</th>
<th style="text-align:right;">
mean…3
</th>
<th style="text-align:right;">
sd…4
</th>
<th style="text-align:left;">
supp…5
</th>
<th style="text-align:right;">
dose…6
</th>
<th style="text-align:right;">
mean…7
</th>
<th style="text-align:right;">
sd…8
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
OJ
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
13.23
</td>
<td style="text-align:right;">
4.46
</td>
<td style="text-align:left;">
VC
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
7.98
</td>
<td style="text-align:right;">
2.75
</td>
</tr>
<tr>
<td style="text-align:left;">
OJ
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
22.70
</td>
<td style="text-align:right;">
3.91
</td>
<td style="text-align:left;">
VC
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
16.77
</td>
<td style="text-align:right;">
2.52
</td>
</tr>
<tr>
<td style="text-align:left;">
OJ
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
26.06
</td>
<td style="text-align:right;">
2.66
</td>
<td style="text-align:left;">
VC
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
26.14
</td>
<td style="text-align:right;">
4.80
</td>
</tr>
</tbody>
</table>
<p>## 这样的数据不方便统计分析，以后别这样了</p>
<ul>
<li>左边的长表格格式整齐，R可以直接处理，但缺点是丢失了原始信息</li>
<li>右边的宽表格R不能直接处理（可以转化，之后课程会讲）</li>
</ul>
</div>
<div id="这样才是好的格式这叫tidy-data" class="section level2 hasAnchor" number="2.10">
<h2><span class="header-section-number">2.10</span> 这样才是好的格式，这叫<strong>Tidy Data</strong><a href="03-dplyr.html#这样才是好的格式这叫tidy-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="htmlwidget-6abc9404104c24859326" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6abc9404104c24859326">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60"],[4.2,11.5,7.3,5.8,6.4,10,11.2,11.2,5.2,7,16.5,16.5,15.2,17.3,22.5,17.3,13.6,14.5,18.8,15.5,23.6,18.5,33.9,25.5,26.4,32.5,26.7,21.5,23.3,29.5,15.2,21.5,17.6,9.7,14.5,10,8.2,9.4,16.5,9.7,19.7,23.3,23.6,26.4,20,25.2,25.8,21.2,14.5,27.3,25.5,26.4,22.4,24.5,24.8,30.9,26.4,27.3,29.4,23],["VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","VC","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ","OJ"],[0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>len<\/th>\n      <th>supp<\/th>\n      <th>dose<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="tidy-data-整齐数据" class="section level2 hasAnchor" number="2.11">
<h2><span class="header-section-number">2.11</span> Tidy Data 整齐数据<a href="03-dplyr.html#tidy-data-整齐数据" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<h3 id="tidy-data-is-data-where" class="hasAnchor">Tidy data is data where:<a href="03-dplyr.html#tidy-data-is-data-where" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</blockquote>
<blockquote>
<h3 id="each-variable-is-in-a-column.-.red每1列对应1个变量" class="hasAnchor">Each variable is in a column. .red[每1列对应1个变量]<a href="03-dplyr.html#each-variable-is-in-a-column.-.red每1列对应1个变量" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h3 id="each-observation-is-a-row.-.red每1行对应1个样本1次观察" class="hasAnchor">Each observation is a row. .red[每1行对应1个样本、1次观察]<a href="03-dplyr.html#each-observation-is-a-row.-.red每1行对应1个样本1次观察" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h3 id="each-value-is-a-cell.-.red每1格包含1个值" class="hasAnchor">Each value is a cell. .red[每1格包含1个值]<a href="03-dplyr.html#each-value-is-a-cell.-.red每1格包含1个值" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</blockquote>
<p><a href="https://www.r-bloggers.com/what-is-tidy-data/">阅读材料：What is “Tidy Data?” https://www.r-bloggers.com/what-is-tidy-data</a></p>
<div id="修改细节使之规范" class="section level3 hasAnchor" number="2.11.1">
<h3><span class="header-section-number">2.11.1</span> 修改细节，使之规范<a href="03-dplyr.html#修改细节使之规范" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="03-dplyr.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len, </span>
<span id="cb222-2"><a href="03-dplyr.html#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="at">color=</span>supp, <span class="at">shape=</span>supp))<span class="sc">+</span></span>
<span id="cb222-3"><a href="03-dplyr.html#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span> <span class="co">#使用黑白主题，默认的是灰色主题</span></span>
<span id="cb222-4"><a href="03-dplyr.html#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;line&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)<span class="sc">+</span></span>
<span id="cb222-5"><a href="03-dplyr.html#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;point&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)<span class="sc">+</span></span>
<span id="cb222-6"><a href="03-dplyr.html#cb222-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;errorbar&quot;</span>, <span class="at">fun.min=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">-</span><span class="fu">sd</span>(x), <span class="at">fun.max=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">+</span><span class="fu">sd</span>(x), <span class="at">width=</span><span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb222-7"><a href="03-dplyr.html#cb222-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Dose (mg/day)&quot;</span>, <span class="co">#x轴标签</span></span>
<span id="cb222-8"><a href="03-dplyr.html#cb222-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">y=</span><span class="st">&quot;Tooth length (mm)&quot;</span>, <span class="co">#y轴标签</span></span>
<span id="cb222-9"><a href="03-dplyr.html#cb222-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">color=</span><span class="st">&quot;Supplement&quot;</span>, <span class="co">#颜色标签</span></span>
<span id="cb222-10"><a href="03-dplyr.html#cb222-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">shape=</span><span class="st">&quot;Supplement&quot;</span>)<span class="sc">+</span> <span class="co">#形状标签，与颜色的一致</span></span>
<span id="cb222-11"><a href="03-dplyr.html#cb222-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>))<span class="sc">+</span> <span class="co">#y轴取值范围</span></span>
<span id="cb222-12"><a href="03-dplyr.html#cb222-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>), <span class="co">#图例的位置，左下角为(0,0),右上角为(1,1)</span></span>
<span id="cb222-13"><a href="03-dplyr.html#cb222-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(), <span class="co">#使图例方框背景透明</span></span>
<span id="cb222-14"><a href="03-dplyr.html#cb222-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>()) <span class="co">#使图例符号背景透明</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p>##<code>ggasve()</code>保存</p>
<ul>
<li>保存下来的图片显示质量比预览的效果更好一些</li>
</ul>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="03-dplyr.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;tooth_1.png&quot;</span>, <span class="at">width=</span><span class="dv">280</span><span class="sc">/</span><span class="dv">90</span>, <span class="at">height=</span><span class="dv">224</span><span class="sc">/</span><span class="dv">90</span>, <span class="at">dpi=</span><span class="dv">600</span>)</span></code></pre></div>
</div>
</div>
<div id="当然用均值标准差格式的数据也可以作图" class="section level2 hasAnchor" number="2.12">
<h2><span class="header-section-number">2.12</span> 当然，用“均值+标准差”格式的数据也可以作图<a href="03-dplyr.html#当然用均值标准差格式的数据也可以作图" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>将此数据命名为<strong><code>d_tooth</code></strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
supp
</th>
<th style="text-align:right;">
dose
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
OJ
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
13.23
</td>
<td style="text-align:right;">
4.46
</td>
</tr>
<tr>
<td style="text-align:left;">
OJ
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
22.70
</td>
<td style="text-align:right;">
3.91
</td>
</tr>
<tr>
<td style="text-align:left;">
OJ
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
26.06
</td>
<td style="text-align:right;">
2.66
</td>
</tr>
<tr>
<td style="text-align:left;">
VC
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
7.98
</td>
<td style="text-align:right;">
2.75
</td>
</tr>
<tr>
<td style="text-align:left;">
VC
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
16.77
</td>
<td style="text-align:right;">
2.52
</td>
</tr>
<tr>
<td style="text-align:left;">
VC
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
26.14
</td>
<td style="text-align:right;">
4.80
</td>
</tr>
</tbody>
</table>
<ul>
<li><strong><code>d_tooth</code></strong>可以通过以下代码得到：</li>
</ul>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="03-dplyr.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb224-2"><a href="03-dplyr.html#cb224-2" aria-hidden="true" tabindex="-1"></a>d_tooth <span class="ot">&lt;-</span> ToothGrowth <span class="sc">%&gt;%</span></span>
<span id="cb224-3"><a href="03-dplyr.html#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(supp, dose) <span class="sc">%&gt;%</span></span>
<span id="cb224-4"><a href="03-dplyr.html#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="fu">vars</span>(len), <span class="fu">funs</span>(mean, sd))</span></code></pre></div>
<pre><code>## Warning: `funs()` was deprecated in dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
</div>
<div id="当然用均值标注差格式的数据也可以作图" class="section level2 hasAnchor" number="2.13">
<h2><span class="header-section-number">2.13</span> 当然，用“均值+标注差”格式的数据也可以作图<a href="03-dplyr.html#当然用均值标注差格式的数据也可以作图" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><strong>用<code>geom_line()</code>画折线；<code>geom_errorbar()</code>画误差棒</strong></li>
</ul>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="03-dplyr.html#cb226-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(d_tooth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>mean, </span>
<span id="cb226-2"><a href="03-dplyr.html#cb226-2" aria-hidden="true" tabindex="-1"></a> <span class="at">color=</span>supp, <span class="at">shape=</span>supp))<span class="sc">+</span></span>
<span id="cb226-3"><a href="03-dplyr.html#cb226-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_bw</span>()<span class="sc">+</span> </span>
<span id="cb226-4"><a href="03-dplyr.html#cb226-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>()<span class="sc">+</span> <span class="co">#画点</span></span>
<span id="cb226-5"><a href="03-dplyr.html#cb226-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>()<span class="sc">+</span> <span class="co">#画线</span></span>
<span id="cb226-6"><a href="03-dplyr.html#cb226-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>mean<span class="sc">-</span>sd, <span class="at">ymax=</span>mean<span class="sc">+</span>sd), <span class="at">width=</span><span class="fl">0.1</span>)<span class="sc">+</span> <span class="co">#画误差棒，注意误差棒的上下限需用aes()映射到mean和sd上</span></span>
<span id="cb226-7"><a href="03-dplyr.html#cb226-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Dose (mg/day)&quot;</span>, </span>
<span id="cb226-8"><a href="03-dplyr.html#cb226-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="st">&quot;Tooth length (mm)&quot;</span>, </span>
<span id="cb226-9"><a href="03-dplyr.html#cb226-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">color=</span><span class="cn">NULL</span>, <span class="co">#去掉了颜色标签</span></span>
<span id="cb226-10"><a href="03-dplyr.html#cb226-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">shape=</span><span class="cn">NULL</span>)<span class="sc">+</span> <span class="co">#去掉了形状标签</span></span>
<span id="cb226-11"><a href="03-dplyr.html#cb226-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>))<span class="sc">+</span> </span>
<span id="cb226-12"><a href="03-dplyr.html#cb226-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>), </span>
<span id="cb226-13"><a href="03-dplyr.html#cb226-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb226-14"><a href="03-dplyr.html#cb226-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.key =</span> <span class="fu">element_blank</span>()) </span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
</div>
<div id="用geom_col画柱状图" class="section level2 hasAnchor" number="2.14">
<h2><span class="header-section-number">2.14</span> 用<code>geom_col()</code>画柱状图<a href="03-dplyr.html#用geom_col画柱状图" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>不要用<code>geom_bar()</code>画柱状图–不是不可以，只是不是按你想的那样</li>
</ul>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="03-dplyr.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_tooth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>mean, <span class="at">color=</span>supp))<span class="sc">+</span></span>
<span id="cb227-2"><a href="03-dplyr.html#cb227-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_col</span>()<span class="sc">+</span></span>
<span id="cb227-3"><a href="03-dplyr.html#cb227-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>mean<span class="sc">-</span>sd, <span class="at">ymax=</span>mean<span class="sc">+</span>sd), <span class="at">width=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<p>这不是我们想要的</p>
<div id="柱子的颜色用fill柱子的边框才是color" class="section level3 hasAnchor" number="2.14.1">
<h3><span class="header-section-number">2.14.1</span> 柱子的颜色用<strong><code>fill</code></strong>，柱子的边框才是<strong><code>color</code></strong><a href="03-dplyr.html#柱子的颜色用fill柱子的边框才是color" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="若有多组柱子需要dodge让他们错开否则默认stack堆叠" class="section level3 hasAnchor" number="2.14.2">
<h3><span class="header-section-number">2.14.2</span> 若有多组柱子，需要<code>dodge</code>让他们错开，否则默认<code>stack</code>堆叠<a href="03-dplyr.html#若有多组柱子需要dodge让他们错开否则默认stack堆叠" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="03-dplyr.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_tooth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>mean,  <span class="at">fill=</span>supp))<span class="sc">+</span></span>
<span id="cb228-2"><a href="03-dplyr.html#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span></span>
<span id="cb228-3"><a href="03-dplyr.html#cb228-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>mean<span class="sc">-</span>sd, <span class="at">ymax=</span>mean<span class="sc">+</span>sd), <span class="at">width=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
</div>
<div id="用position-position_dodge错开多组误差棒" class="section level3 hasAnchor" number="2.14.3">
<h3><span class="header-section-number">2.14.3</span> 用<strong><code>position = position_dodge()</code></strong>，错开多组误差棒<a href="03-dplyr.html#用position-position_dodge错开多组误差棒" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="03-dplyr.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_tooth, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>mean, <span class="at">fill=</span>supp))<span class="sc">+</span></span>
<span id="cb229-2"><a href="03-dplyr.html#cb229-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span></span>
<span id="cb229-3"><a href="03-dplyr.html#cb229-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>mean<span class="sc">-</span>sd, <span class="at">ymax=</span>mean<span class="sc">+</span>sd), <span class="at">width=</span><span class="fl">0.1</span>,</span>
<span id="cb229-4"><a href="03-dplyr.html#cb229-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.45</span>))</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
</div>
<div id="把x轴的dose变为factor类型使柱子之间等间隔" class="section level3 hasAnchor" number="2.14.4">
<h3><span class="header-section-number">2.14.4</span> 把x轴的<code>dose</code>变为<code>factor</code>类型，使柱子之间等间隔<a href="03-dplyr.html#把x轴的dose变为factor类型使柱子之间等间隔" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="03-dplyr.html#cb230-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d_tooth, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(dose), <span class="at">y=</span>mean, <span class="at">fill=</span>supp))<span class="sc">+</span></span>
<span id="cb230-2"><a href="03-dplyr.html#cb230-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span></span>
<span id="cb230-3"><a href="03-dplyr.html#cb230-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>mean<span class="sc">-</span>sd, <span class="at">ymax=</span>mean<span class="sc">+</span>sd), <span class="at">width=</span><span class="fl">0.1</span>,</span>
<span id="cb230-4"><a href="03-dplyr.html#cb230-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>)) <span class="co">#注意width也改为0.9，这个可以试错出来</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
</div>
</div>
<div id="修改细节使之规范-1" class="section level2 hasAnchor" number="2.15">
<h2><span class="header-section-number">2.15</span> 修改细节，使之规范<a href="03-dplyr.html#修改细节使之规范-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="03-dplyr.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_tooth, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(dose), <span class="at">y=</span>mean, <span class="at">fill=</span>supp))<span class="sc">+</span></span>
<span id="cb231-2"><a href="03-dplyr.html#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb231-3"><a href="03-dplyr.html#cb231-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="at">width =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb231-4"><a href="03-dplyr.html#cb231-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>mean<span class="sc">-</span>sd, <span class="at">ymax=</span>mean<span class="sc">+</span>sd, <span class="at">color=</span>supp), <span class="at">width=</span><span class="fl">0.1</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.7</span>))<span class="sc">+</span></span>
<span id="cb231-5"><a href="03-dplyr.html#cb231-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">expression</span>(<span class="st">&quot;Dose (mg&quot;</span><span class="sc">~</span>d<span class="sc">^</span><span class="st">&quot;-1&quot;</span><span class="sc">*</span><span class="st">&quot;)&quot;</span>),</span>
<span id="cb231-6"><a href="03-dplyr.html#cb231-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Tooth length (mm)&quot;</span>,</span>
<span id="cb231-7"><a href="03-dplyr.html#cb231-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill=</span><span class="cn">NULL</span>, <span class="at">color=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb231-8"><a href="03-dplyr.html#cb231-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.86</span>),</span>
<span id="cb231-9"><a href="03-dplyr.html#cb231-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb231-10"><a href="03-dplyr.html#cb231-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
<p>##柱状图完成，<code>ggasve()</code>保存</p>
<ul>
<li>除了默认的颜色土一点，基本达到发表的要求了（颜色以后我们专题讨论）</li>
</ul>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="03-dplyr.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;tooth_2.png&quot;</span>, <span class="at">width=</span><span class="dv">316</span><span class="sc">/</span><span class="dv">90</span>, <span class="at">height=</span><span class="dv">232</span><span class="sc">/</span><span class="dv">90</span>, <span class="at">dpi=</span><span class="dv">600</span>)</span></code></pre></div>
</div>
<div id="直接用tidy-datatoothgrowth作柱状图" class="section level2 hasAnchor" number="2.16">
<h2><span class="header-section-number">2.16</span> 直接用<code>Tidy Data</code>（<code>ToothGrowth</code>）作柱状图<a href="03-dplyr.html#直接用tidy-datatoothgrowth作柱状图" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="03-dplyr.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(dose), <span class="at">y=</span>len, <span class="at">fill=</span>supp))<span class="sc">+</span></span>
<span id="cb233-2"><a href="03-dplyr.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb233-3"><a href="03-dplyr.html#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;col&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>, <span class="at">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="at">width =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb233-4"><a href="03-dplyr.html#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&quot;errorbar&quot;</span>, <span class="at">fun.min=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">-</span><span class="fu">sd</span>(x), <span class="at">fun.max=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">+</span><span class="fu">sd</span>(x), <span class="fu">aes</span>(<span class="at">color=</span>supp), <span class="at">width=</span><span class="fl">0.1</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.7</span>))<span class="sc">+</span></span>
<span id="cb233-5"><a href="03-dplyr.html#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">expression</span>(<span class="st">&quot;Dose (mg&quot;</span><span class="sc">~</span>d<span class="sc">^</span><span class="st">&quot;-1&quot;</span><span class="sc">*</span><span class="st">&quot;)&quot;</span>),</span>
<span id="cb233-6"><a href="03-dplyr.html#cb233-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Tooth length (mm)&quot;</span>,</span>
<span id="cb233-7"><a href="03-dplyr.html#cb233-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill=</span><span class="cn">NULL</span>, <span class="at">color=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb233-8"><a href="03-dplyr.html#cb233-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.86</span>),</span>
<span id="cb233-9"><a href="03-dplyr.html#cb233-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb233-10"><a href="03-dplyr.html#cb233-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
</div>
<div id="用geom_boxplot画箱式图" class="section level2 hasAnchor" number="2.17">
<h2><span class="header-section-number">2.17</span> 用<code>geom_boxplot()</code>画箱式图<a href="03-dplyr.html#用geom_boxplot画箱式图" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="03-dplyr.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(dose, len,  <span class="at">color=</span>supp))<span class="sc">+</span></span>
<span id="cb234-2"><a href="03-dplyr.html#cb234-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-95-1.png" width="672" /></p>
<ul>
<li><strong>问题出在哪：<code>dose</code>是连续变量（<code>numeric</code>格式），不适合boxplot，需先转化为<code>factor</code></strong></li>
</ul>
</div>
<div id="用factor将数值变量转化为因子" class="section level2 hasAnchor" number="2.18">
<h2><span class="header-section-number">2.18</span> 用<code>factor()</code>将数值变量转化为因子<a href="03-dplyr.html#用factor将数值变量转化为因子" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="03-dplyr.html#cb235-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="fu">factor</span>(dose), len,  <span class="at">color=</span>supp))<span class="sc">+</span></span>
<span id="cb235-2"><a href="03-dplyr.html#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-96-1.png" width="672" /></p>
<p>##修饰细节，使之规范</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="03-dplyr.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="fu">factor</span>(dose), len,  <span class="at">color=</span>supp))<span class="sc">+</span></span>
<span id="cb236-2"><a href="03-dplyr.html#cb236-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb236-3"><a href="03-dplyr.html#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb236-4"><a href="03-dplyr.html#cb236-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">expression</span>(<span class="st">&quot;Dose (mg&quot;</span><span class="sc">~</span>d<span class="sc">^</span><span class="st">&quot;-1&quot;</span><span class="sc">*</span><span class="st">&quot;)&quot;</span>),</span>
<span id="cb236-5"><a href="03-dplyr.html#cb236-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="st">&quot;Tooth length (mm)&quot;</span>, <span class="at">color=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb236-6"><a href="03-dplyr.html#cb236-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.86</span>),</span>
<span id="cb236-7"><a href="03-dplyr.html#cb236-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb236-8"><a href="03-dplyr.html#cb236-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
<hr />
</div>
<div id="要点小结" class="section level2 hasAnchor" number="2.19">
<h2><span class="header-section-number">2.19</span> 要点小结<a href="03-dplyr.html#要点小结" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<colgroup>
<col width="35%" />
<col width="64%" />
</colgroup>
<thead>
<tr class="header">
<th>图</th>
<th>函数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>点</td>
<td><code>geom_point()</code></td>
</tr>
<tr class="even">
<td>线</td>
<td><code>geom_line()</code></td>
</tr>
<tr class="odd">
<td>柱</td>
<td><code>geom_col()</code>推荐； <code>geom_bar()</code></td>
</tr>
<tr class="even">
<td>箱</td>
<td><code>geom_boxplot()</code></td>
</tr>
<tr class="odd">
<td>误差棒</td>
<td><code>geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd))</code></td>
</tr>
<tr class="even">
<td>统计-误差棒</td>
<td><code>stat_summary(geom="errorbar", fun.min=function(x) mean(x)-sd(x), fun.max=function(x) mean(x)+sd(x))</code></td>
</tr>
<tr class="odd">
<td>统计-均值点</td>
<td><code>stat_summary(geom="point", fun="mean")</code></td>
</tr>
<tr class="even">
<td>统计-均值线</td>
<td><code>stat_summary(geom="line", fun="mean")</code></td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="阅读作业" class="section level2 hasAnchor" number="2.20">
<h2><span class="header-section-number">2.20</span> 阅读作业<a href="03-dplyr.html#阅读作业" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="hadley-wickham.-2016.-ggplot2-elegant-graphics-for-data-analysis." class="section level3 hasAnchor" number="2.20.1">
<h3><span class="header-section-number">2.20.1</span> Hadley Wickham. 2016. ggplot2 Elegant Graphics for Data Analysis.<a href="03-dplyr.html#hadley-wickham.-2016.-ggplot2-elegant-graphics-for-data-analysis." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>.large2[Chapter 2. Getting Started with ggplot. pp. 11-32]</li>
<li>.large2[Chapter 3. Toolbox. pp. 33-74]</li>
</ul>
</div>
</div>
<div id="进阶拟合及结果可视化" class="section level2 hasAnchor" number="2.21">
<h2><span class="header-section-number">2.21</span> 进阶：拟合及结果可视化<a href="03-dplyr.html#进阶拟合及结果可视化" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>R自带的另一套数据<strong><code>DNase</code></strong>
&gt; <strong>Elisa assay of DNase</strong><br />
&gt; Description<br />
&gt; The DNase data frame has 176 rows and 3 columns of data obtained during development of an ELISA assay for the recombinant protein DNase in rat serum.</li>
</ul>
<blockquote>
<p>Source<br />
Davidian, M. and Giltinan, D. M. (1995) Nonlinear Models for Repeated Measurement Data, Chapman &amp; Hall (section 5.2.4, p. 134</p>
</blockquote>
<p>###这套数据和我们研究中遇到的数据很类似。用ELISA方法测定大鼠血清中的DNA酶，得到酶浓度和吸光度数据。实验做了11次，每次测定有平行样。</p>
</div>
<div id="先用head和str来查看数据" class="section level2 hasAnchor" number="2.22">
<h2><span class="header-section-number">2.22</span> 先用<strong><code>head()</code></strong>和<strong><code>str()</code></strong>来查看数据<a href="03-dplyr.html#先用head和str来查看数据" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="03-dplyr.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DNase)</span></code></pre></div>
<pre><code>## Grouped Data: density ~ conc | Run
##   Run       conc density
## 1   1 0.04882812   0.017
## 2   1 0.04882812   0.018
## 3   1 0.19531250   0.121
## 4   1 0.19531250   0.124
## 5   1 0.39062500   0.206
## 6   1 0.39062500   0.215</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="03-dplyr.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(DNase)</span></code></pre></div>
<pre><code>## Classes &#39;nfnGroupedData&#39;, &#39;nfGroupedData&#39;, &#39;groupedData&#39; and &#39;data.frame&#39;:   176 obs. of  3 variables:
##  $ Run    : Ord.factor w/ 11 levels &quot;10&quot;&lt;&quot;11&quot;&lt;&quot;9&quot;&lt;..: 4 4 4 4 4 4 4 4 4 4 ...
##  $ conc   : num  0.0488 0.0488 0.1953 0.1953 0.3906 ...
##  $ density: num  0.017 0.018 0.121 0.124 0.206 0.215 0.377 0.374 0.614 0.609 ...
##  - attr(*, &quot;formula&quot;)=Class &#39;formula&#39;  language density ~ conc | Run
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_EmptyEnv&gt; 
##  - attr(*, &quot;labels&quot;)=List of 2
##   ..$ x: chr &quot;DNase concentration&quot;
##   ..$ y: chr &quot;Optical density&quot;
##  - attr(*, &quot;units&quot;)=List of 1
##   ..$ x: chr &quot;(ng/ml)&quot;</code></pre>
<p>注意：<code>Run</code>虽然是数字，类型却是<code>factor</code>，因此后面<code>facet</code>时可以直接操作，而无需转化为<code>factor</code>。</p>
</div>
<div id="散点图是我们对数据进行探索分析的法宝" class="section level2 hasAnchor" number="2.23">
<h2><span class="header-section-number">2.23</span> 散点图是我们对数据进行探索分析的法宝<a href="03-dplyr.html#散点图是我们对数据进行探索分析的法宝" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="03-dplyr.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb241-2"><a href="03-dplyr.html#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(DNase, <span class="fu">aes</span>(conc, density))<span class="sc">+</span></span>
<span id="cb241-3"><a href="03-dplyr.html#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-100-1.png" width="672" /></p>
<p>这个数据让你想起了什么？有点像酶反应里的米氏动力学。确定分析方向：用米氏方程去拟合数据</p>
</div>
<div id="均值标准差换一种方法" class="section level2 hasAnchor" number="2.24">
<h2><span class="header-section-number">2.24</span> 均值+标准差（换一种方法）<a href="03-dplyr.html#均值标准差换一种方法" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="03-dplyr.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(DNase, <span class="fu">aes</span>(conc, density))<span class="sc">+</span></span>
<span id="cb242-2"><a href="03-dplyr.html#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat=</span><span class="st">&quot;summary&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)<span class="sc">+</span></span>
<span id="cb242-3"><a href="03-dplyr.html#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">stat=</span><span class="st">&quot;summary&quot;</span>, </span>
<span id="cb242-4"><a href="03-dplyr.html#cb242-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">fun.min=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">-</span><span class="fu">sd</span>(x), </span>
<span id="cb242-5"><a href="03-dplyr.html#cb242-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">fun.max=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">+</span><span class="fu">sd</span>(x), <span class="at">width=</span><span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
</div>
<div id="对比两种等价的作图方法" class="section level2 hasAnchor" number="2.25">
<h2><span class="header-section-number">2.25</span> 对比两种等价的作图方法<a href="03-dplyr.html#对比两种等价的作图方法" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<thead>
<tr class="header">
<th>方法1</th>
<th>方法2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>geom_errorbar(stat="summary",...)</code></td>
<td><code>stat_summary(geom="errorbar",...)</code></td>
</tr>
<tr class="even">
<td><code>geom_point(stat="summary",...)</code></td>
<td><code>stat_summary(geom="point",...)</code></td>
</tr>
<tr class="odd">
<td><code>geom_line(stat="summary",...)</code></td>
<td><code>stat_summary(geom="line",...)</code></td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
</div>
<div id="nls非线性拟合米氏方程手动提取拟合结果" class="section level2 hasAnchor" number="2.26">
<h2><span class="header-section-number">2.26</span> <strong><code>nls()</code></strong>非线性拟合米氏方程：手动提取拟合结果<a href="03-dplyr.html#nls非线性拟合米氏方程手动提取拟合结果" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>米氏方程： <span class="math inline">\(V=\frac{V\text{max}\times C}{K_\text{M}+C}\)</span></p></li>
<li><p>非线性拟合<br />
拟合前，仔细观察原始数据，运用你的智慧大致判断一下Vmax和KM的值</p></li>
</ul>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="03-dplyr.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nls</span>(density <span class="sc">~</span> conc <span class="sc">*</span> Vmax<span class="sc">/</span>(KM <span class="sc">+</span> conc), <span class="at">data=</span>DNase, <span class="at">start=</span><span class="fu">list</span>(<span class="at">Vmax=</span><span class="dv">2</span>, <span class="at">KM=</span><span class="dv">6</span>) )</span></code></pre></div>
<pre><code>## Nonlinear regression model
##   model: density ~ conc * Vmax/(KM + conc)
##    data: DNase
##  Vmax    KM 
## 2.280 3.682 
##  residual sum-of-squares: 0.4192
## 
## Number of iterations to convergence: 6 
## Achieved convergence tolerance: 5.139e-06</code></pre>
<ul>
<li>手动赋值</li>
</ul>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="03-dplyr.html#cb245-1" aria-hidden="true" tabindex="-1"></a>Vmax <span class="ot">&lt;-</span> <span class="fl">2.280</span> </span>
<span id="cb245-2"><a href="03-dplyr.html#cb245-2" aria-hidden="true" tabindex="-1"></a>KM <span class="ot">&lt;-</span> <span class="fl">3.682</span></span></code></pre></div>
</div>
<div id="nls非线性拟合米氏方程自动提取拟合结果-1" class="section level2 hasAnchor" number="2.27">
<h2><span class="header-section-number">2.27</span> <strong><code>nls()</code></strong>非线性拟合米氏方程：自动提取拟合结果-1<a href="03-dplyr.html#nls非线性拟合米氏方程自动提取拟合结果-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>将拟合结果存入<strong><code>fit</code></strong></li>
</ul>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="03-dplyr.html#cb246-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(density <span class="sc">~</span> conc <span class="sc">*</span> Vmax<span class="sc">/</span>(KM <span class="sc">+</span> conc), <span class="at">data=</span>DNase, <span class="at">start=</span><span class="fu">list</span>(<span class="at">Vmax=</span><span class="dv">2</span>, <span class="at">KM=</span><span class="dv">6</span>) )</span></code></pre></div>
<ul>
<li>查看结果</li>
</ul>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="03-dplyr.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Formula: density ~ conc * Vmax/(KM + conc)
## 
## Parameters:
##      Estimate Std. Error t value Pr(&gt;|t|)    
## Vmax  2.28032    0.02189  104.16   &lt;2e-16 ***
## KM    3.68241    0.08677   42.44   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.04909 on 174 degrees of freedom
## 
## Number of iterations to convergence: 6 
## Achieved convergence tolerance: 5.139e-06</code></pre>
</div>
<div id="nls非线性拟合米氏方程自动提取拟合结果-2" class="section level2 hasAnchor" number="2.28">
<h2><span class="header-section-number">2.28</span> <strong><code>nls()</code></strong>非线性拟合米氏方程：自动提取拟合结果-2<a href="03-dplyr.html#nls非线性拟合米氏方程自动提取拟合结果-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>查看都储存了哪些信息</li>
</ul>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="03-dplyr.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">summary</span>(fit)) </span></code></pre></div>
<pre><code>##  [1] &quot;formula&quot;      &quot;residuals&quot;    &quot;sigma&quot;        &quot;df&quot;           &quot;cov.unscaled&quot;
##  [6] &quot;call&quot;         &quot;convInfo&quot;     &quot;control&quot;      &quot;na.action&quot;    &quot;coefficients&quot;
## [11] &quot;parameters&quot;</code></pre>
<ul>
<li>提取我们需要的参数拟合值</li>
</ul>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="03-dplyr.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##      Estimate Std. Error   t value      Pr(&gt;|t|)
## Vmax 2.280318 0.02189237 104.16041 1.073541e-158
## KM   3.682409 0.08677038  42.43855  1.032031e-93</code></pre>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="03-dplyr.html#cb253-1" aria-hidden="true" tabindex="-1"></a>Vmax <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)<span class="sc">$</span>coefficients[<span class="dv">1</span>]</span>
<span id="cb253-2"><a href="03-dplyr.html#cb253-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-3"><a href="03-dplyr.html#cb253-3" aria-hidden="true" tabindex="-1"></a>KM <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span></code></pre></div>
</div>
<div id="生成画拟合线所需的数据" class="section level2 hasAnchor" number="2.29">
<h2><span class="header-section-number">2.29</span> 生成画拟合线所需的数据<a href="03-dplyr.html#生成画拟合线所需的数据" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>生成数据</li>
</ul>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="03-dplyr.html#cb254-1" aria-hidden="true" tabindex="-1"></a>fit_x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">14</span>, <span class="at">length.out=</span><span class="dv">100</span>) <span class="co">#生成100个x，涵盖原始数据范围</span></span>
<span id="cb254-2"><a href="03-dplyr.html#cb254-2" aria-hidden="true" tabindex="-1"></a>fit_y <span class="ot">&lt;-</span> Vmax <span class="sc">*</span> fit_x <span class="sc">/</span>(KM <span class="sc">+</span> fit_x) <span class="co">#将x和参数值代入米氏方程，计算y</span></span>
<span id="cb254-3"><a href="03-dplyr.html#cb254-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-4"><a href="03-dplyr.html#cb254-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-5"><a href="03-dplyr.html#cb254-5" aria-hidden="true" tabindex="-1"></a>d_fit <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">conc=</span>fit_x, <span class="at">density=</span>fit_y) <span class="co">#注意命名和原数据保持一致，可以不一致，但一致的话画图更简单</span></span></code></pre></div>
<ul>
<li>查看一下所生成的数据</li>
</ul>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="03-dplyr.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d_fit)</span></code></pre></div>
<pre><code>##        conc    density
## 1 0.0000000 0.00000000
## 2 0.1414141 0.08433162
## 3 0.2828283 0.16264812
## 4 0.4242424 0.23557091
## 5 0.5656566 0.30363863
## 6 0.7070707 0.36732053</code></pre>
</div>
<div id="添加拟合线" class="section level2 hasAnchor" number="2.30">
<h2><span class="header-section-number">2.30</span> 添加拟合线<a href="03-dplyr.html#添加拟合线" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="03-dplyr.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(DNase, <span class="fu">aes</span>(conc, density))<span class="sc">+</span></span>
<span id="cb257-2"><a href="03-dplyr.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat=</span><span class="st">&quot;summary&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)<span class="sc">+</span></span>
<span id="cb257-3"><a href="03-dplyr.html#cb257-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">stat=</span><span class="st">&quot;summary&quot;</span>, </span>
<span id="cb257-4"><a href="03-dplyr.html#cb257-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">fun.min=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">-</span><span class="fu">sd</span>(x), </span>
<span id="cb257-5"><a href="03-dplyr.html#cb257-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">fun.max=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">+</span><span class="fu">sd</span>(x), <span class="at">width=</span><span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb257-6"><a href="03-dplyr.html#cb257-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>d_fit) <span class="co">#不需要设定aes(x=,y=)，因为继承了第1行代码的设定；如果xy名字与原数据不一样，则需设定。</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>
</div>
<div id="修饰细节" class="section level2 hasAnchor" number="2.31">
<h2><span class="header-section-number">2.31</span> 修饰细节<a href="03-dplyr.html#修饰细节" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="03-dplyr.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(DNase, <span class="fu">aes</span>(conc, density))<span class="sc">+</span></span>
<span id="cb258-2"><a href="03-dplyr.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb258-3"><a href="03-dplyr.html#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>d_fit, <span class="at">size=</span><span class="fl">0.7</span>, <span class="at">alpha=</span><span class="fl">0.7</span>, <span class="at">color=</span><span class="st">&quot;red2&quot;</span>)<span class="sc">+</span></span>
<span id="cb258-4"><a href="03-dplyr.html#cb258-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat=</span><span class="st">&quot;summary&quot;</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>, <span class="at">color=</span><span class="st">&quot;grey30&quot;</span>, <span class="at">alpha=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb258-5"><a href="03-dplyr.html#cb258-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">stat=</span><span class="st">&quot;summary&quot;</span>, <span class="at">fun.min=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">-</span><span class="fu">sd</span>(x), <span class="at">fun.max=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x)<span class="sc">+</span><span class="fu">sd</span>(x), <span class="at">width=</span><span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb258-6"><a href="03-dplyr.html#cb258-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">expression</span>(<span class="st">&quot;DNase concentration (ng&quot;</span><span class="sc">~</span>mL<span class="sc">^</span><span class="st">&quot;-1&quot;</span><span class="sc">*</span><span class="st">&quot;)&quot;</span>),</span>
<span id="cb258-7"><a href="03-dplyr.html#cb258-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Optical density&quot;</span>)<span class="sc">+</span></span>
<span id="cb258-8"><a href="03-dplyr.html#cb258-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="dv">10</span>, <span class="at">y=</span><span class="fl">0.5</span>,<span class="at">label=</span><span class="fu">expression</span>(OD<span class="sc">==</span><span class="fu">frac</span>(OD[max], <span class="fu">italic</span>(K)[M]<span class="sc">+</span><span class="fu">italic</span>(C)))) <span class="co"># 添加公式</span></span></code></pre></div>
<pre><code>## Warning in is.na(x): is.na() applied to non-(list or vector) of type
## &#39;expression&#39;</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-111-1.png" width="672" /></p>
</div>
<div id="如何在图上添加数学公式" class="section level2 hasAnchor" number="2.32">
<h2><span class="header-section-number">2.32</span> 如何在图上添加数学公式？<a href="03-dplyr.html#如何在图上添加数学公式" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><code>annotate(geom="text", x=..., y=..., label=...)</code></li>
<li>.red[<code>?plotmath</code>]查看各种公式的代码</li>
</ol>
<ul>
<li>例如：</li>
</ul>
<table>
<thead>
<tr class="header">
<th>Syntax</th>
<th>Meaning</th>
<th></th>
<th>Syntax</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>x + y</td>
<td>x plus y</td>
<td></td>
<td>sqrt(x)</td>
<td>square root of x</td>
</tr>
<tr class="even">
<td>x - y</td>
<td>x minus y</td>
<td></td>
<td>x == y</td>
<td>x equals y</td>
</tr>
<tr class="odd">
<td>x %+-% y</td>
<td>x plus or minus y</td>
<td></td>
<td>italic(x)</td>
<td>draw x in italic font</td>
</tr>
<tr class="even">
<td>x %.% y</td>
<td>x cdot y</td>
<td></td>
<td>alpha – omega</td>
<td>Greek symbols</td>
</tr>
<tr class="odd">
<td>x[i]</td>
<td>x subscript i</td>
<td></td>
<td>frac(x, y)</td>
<td>x over y</td>
</tr>
<tr class="even">
<td>x^2</td>
<td>x superscript 2</td>
<td></td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
</div>
<div id="另一个探索数据的超级武器分面facet" class="section level2 hasAnchor" number="2.33">
<h2><span class="header-section-number">2.33</span> 另一个探索数据的超级武器：分面<strong><code>facet</code></strong><a href="03-dplyr.html#另一个探索数据的超级武器分面facet" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>有两种分面：</strong><br />
- <code>facet_wrap(~因子)</code>：针对1个因子，1维分面<br />
- <code>facet_grid(因子1~因子2)</code>：针对2个因子，2维分面</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="03-dplyr.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(DNase, <span class="fu">aes</span>(conc, density))<span class="sc">+</span></span>
<span id="cb260-2"><a href="03-dplyr.html#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb260-3"><a href="03-dplyr.html#cb260-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">facet_wrap</span>(<span class="sc">~</span>Run) <span class="co"># 针对Run这个因子分面</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-112-1.png" width="672" /></p>
<ul>
<li><strong>每个Run都单独作图，数据趋势类似</strong><br />
</li>
<li><strong>每组数据可以单独拟合，看看参数的变异程度</strong></li>
</ul>
</div>
<div id="运用for循环语句批量拟合11组数据" class="section level2 hasAnchor" number="2.34">
<h2><span class="header-section-number">2.34</span> 运用<code>for()</code>循环语句，批量拟合11组数据<a href="03-dplyr.html#运用for循环语句批量拟合11组数据" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="03-dplyr.html#cb261-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(DNase<span class="sc">$</span>Run)) <span class="co"># 有几组数据？直译：不重复的Run这个向量的长度</span></span>
<span id="cb261-2"><a href="03-dplyr.html#cb261-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-3"><a href="03-dplyr.html#cb261-3" aria-hidden="true" tabindex="-1"></a>Vmax_each <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N) <span class="co">#生成长度为N的向量，以备存储拟合值</span></span>
<span id="cb261-4"><a href="03-dplyr.html#cb261-4" aria-hidden="true" tabindex="-1"></a>KM_each <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb261-5"><a href="03-dplyr.html#cb261-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-6"><a href="03-dplyr.html#cb261-6" aria-hidden="true" tabindex="-1"></a><span class="co">#运用循环语句，每次拟合1组数据</span></span>
<span id="cb261-7"><a href="03-dplyr.html#cb261-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> N) {</span>
<span id="cb261-8"><a href="03-dplyr.html#cb261-8" aria-hidden="true" tabindex="-1"></a>d_i <span class="ot">&lt;-</span> <span class="fu">subset</span>(DNase, Run<span class="sc">==</span>i) <span class="co">#把第i组数据筛选出来</span></span>
<span id="cb261-9"><a href="03-dplyr.html#cb261-9" aria-hidden="true" tabindex="-1"></a>fit_i <span class="ot">&lt;-</span> <span class="fu">nls</span>(density <span class="sc">~</span> conc <span class="sc">*</span> Vmax<span class="sc">/</span>(KM <span class="sc">+</span> conc), <span class="at">data=</span>d_i, <span class="at">start=</span><span class="fu">list</span>(<span class="at">Vmax=</span><span class="dv">2</span>, <span class="at">KM=</span><span class="dv">6</span>) )</span>
<span id="cb261-10"><a href="03-dplyr.html#cb261-10" aria-hidden="true" tabindex="-1"></a>Vmax_each[i] <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit_i)<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co">#第i个拟合结果存入向量第i个位置</span></span>
<span id="cb261-11"><a href="03-dplyr.html#cb261-11" aria-hidden="true" tabindex="-1"></a>KM_each[i] <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit_i)<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co">#同上</span></span>
<span id="cb261-12"><a href="03-dplyr.html#cb261-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>将拟合值存入数据表备用</li>
</ul>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="03-dplyr.html#cb262-1" aria-hidden="true" tabindex="-1"></a>d_Vmax_KM <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vmax_each, KM_each) </span></code></pre></div>
<p>##查看一下11组拟合结果</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="03-dplyr.html#cb263-1" aria-hidden="true" tabindex="-1"></a>d_Vmax_KM</span></code></pre></div>
<pre><code>##    Vmax_each  KM_each
## 1   2.258552 4.021074
## 2   2.591009 4.305742
## 3   2.571666 4.120585
## 4   2.333150 4.227158
## 5   2.264528 3.725127
## 6   2.246484 3.380303
## 7   2.171841 3.264675
## 8   2.254738 3.727607
## 9   2.173733 3.423064
## 10  2.087056 3.032812
## 11  2.168591 3.413008</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="03-dplyr.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Vmax_each)</span></code></pre></div>
<pre><code>## [1] 2.283759</code></pre>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="03-dplyr.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(Vmax_each)</span></code></pre></div>
<pre><code>## [1] 0.1611077</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="03-dplyr.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(KM_each)</span></code></pre></div>
<pre><code>## [1] 3.69465</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="03-dplyr.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(KM_each)</span></code></pre></div>
<pre><code>## [1] 0.4268242</code></pre>
</div>
<div id="生成画11条拟合线的数据" class="section level2 hasAnchor" number="2.35">
<h2><span class="header-section-number">2.35</span> 生成画11条拟合线的数据<a href="03-dplyr.html#生成画11条拟合线的数据" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="03-dplyr.html#cb273-1" aria-hidden="true" tabindex="-1"></a>fit_x_11 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">14</span>, <span class="at">length.out=</span><span class="dv">100</span>), <span class="at">times=</span><span class="dv">11</span>) <span class="co">#生成等间距x值100个，重复11次</span></span>
<span id="cb273-2"><a href="03-dplyr.html#cb273-2" aria-hidden="true" tabindex="-1"></a>Vmax_11 <span class="ot">&lt;-</span> <span class="fu">rep</span>(Vmax_each, <span class="at">each=</span><span class="dv">100</span>) <span class="co">#复制Vmax，复制100份</span></span>
<span id="cb273-3"><a href="03-dplyr.html#cb273-3" aria-hidden="true" tabindex="-1"></a>KM_11 <span class="ot">&lt;-</span> <span class="fu">rep</span>(KM_each, <span class="at">each=</span><span class="dv">100</span>) <span class="co">#复制KM，复制100份</span></span>
<span id="cb273-4"><a href="03-dplyr.html#cb273-4" aria-hidden="true" tabindex="-1"></a>fit_y_11 <span class="ot">&lt;-</span> Vmax_11 <span class="sc">*</span> fit_x_11 <span class="sc">/</span>(KM_11 <span class="sc">+</span> fit_x_11) <span class="co">#将以上三者代入米氏方程，计算y（想象一下你熟悉的excel，操作其实是一样的）</span></span>
<span id="cb273-5"><a href="03-dplyr.html#cb273-5" aria-hidden="true" tabindex="-1"></a>Run <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>, <span class="at">each=</span><span class="dv">100</span>) <span class="co">#复制Run编号，复制100份</span></span>
<span id="cb273-6"><a href="03-dplyr.html#cb273-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-7"><a href="03-dplyr.html#cb273-7" aria-hidden="true" tabindex="-1"></a>d_fit_11 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">conc=</span>fit_x_11, <span class="at">density=</span>fit_y_11, <span class="at">Run=</span>Run)</span></code></pre></div>
</div>
<div id="画11条拟合线" class="section level2 hasAnchor" number="2.36">
<h2><span class="header-section-number">2.36</span> 画11条拟合线<a href="03-dplyr.html#画11条拟合线" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="03-dplyr.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(DNase, <span class="fu">aes</span>(conc, density))<span class="sc">+</span></span>
<span id="cb274-2"><a href="03-dplyr.html#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb274-3"><a href="03-dplyr.html#cb274-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Run)<span class="sc">+</span></span>
<span id="cb274-4"><a href="03-dplyr.html#cb274-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_line</span>(<span class="at">data=</span>d_fit_11) <span class="co"># 把11条拟合线画上去</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-118-1.png" width="672" /></p>
</div>
<div id="修改细节" class="section level2 hasAnchor" number="2.37">
<h2><span class="header-section-number">2.37</span> 修改细节<a href="03-dplyr.html#修改细节" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="03-dplyr.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co">#把这11个Run从1到11重新排好顺序</span></span>
<span id="cb275-2"><a href="03-dplyr.html#cb275-2" aria-hidden="true" tabindex="-1"></a>DNase<span class="sc">$</span>Run <span class="ot">&lt;-</span> <span class="fu">factor</span>(DNase<span class="sc">$</span>Run, </span>
<span id="cb275-3"><a href="03-dplyr.html#cb275-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>,<span class="st">&quot;4&quot;</span>,<span class="st">&quot;5&quot;</span>,<span class="st">&quot;6&quot;</span>,</span>
<span id="cb275-4"><a href="03-dplyr.html#cb275-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;7&quot;</span>,<span class="st">&quot;8&quot;</span>,<span class="st">&quot;9&quot;</span>,<span class="st">&quot;10&quot;</span>,<span class="st">&quot;11&quot;</span>)) </span>
<span id="cb275-5"><a href="03-dplyr.html#cb275-5" aria-hidden="true" tabindex="-1"></a>d_fit_11<span class="sc">$</span>Run <span class="ot">&lt;-</span> <span class="fu">factor</span>(d_fit_11<span class="sc">$</span>Run, </span>
<span id="cb275-6"><a href="03-dplyr.html#cb275-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>,<span class="st">&quot;4&quot;</span>,<span class="st">&quot;5&quot;</span>,<span class="st">&quot;6&quot;</span>,</span>
<span id="cb275-7"><a href="03-dplyr.html#cb275-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;7&quot;</span>,<span class="st">&quot;8&quot;</span>,<span class="st">&quot;9&quot;</span>,<span class="st">&quot;10&quot;</span>,<span class="st">&quot;11&quot;</span>)) </span>
<span id="cb275-8"><a href="03-dplyr.html#cb275-8" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb275-9"><a href="03-dplyr.html#cb275-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(DNase, <span class="fu">aes</span>(conc, density))<span class="sc">+</span></span>
<span id="cb275-10"><a href="03-dplyr.html#cb275-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb275-11"><a href="03-dplyr.html#cb275-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb275-12"><a href="03-dplyr.html#cb275-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Run)<span class="sc">+</span></span>
<span id="cb275-13"><a href="03-dplyr.html#cb275-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>d_fit_11, <span class="at">size=</span><span class="fl">0.7</span>, <span class="at">color=</span><span class="st">&quot;red2&quot;</span>)<span class="sc">+</span></span>
<span id="cb275-14"><a href="03-dplyr.html#cb275-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">expression</span>(<span class="st">&quot;DNase concentration (ng&quot;</span><span class="sc">~</span>mL<span class="sc">^</span><span class="st">&quot;-1&quot;</span><span class="sc">*</span><span class="st">&quot;)&quot;</span>),</span>
<span id="cb275-15"><a href="03-dplyr.html#cb275-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">&quot;Optical density&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-119-1.png" width="672" /></p>
<table style="width:6%;">
<colgroup>
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th>## 图上各主题元素的修改方法
参考此网页：<a href="https://ggplot2.tidyverse.org/reference/theme.html" class="uri">https://ggplot2.tidyverse.org/reference/theme.html</a></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>## 要点小结</td>
</tr>
<tr class="even">
<td><strong>理解两种等价的作图方式</strong>(若有困难，选一种你觉得容易理解的记住)
- <code>geom_xxx(stat="summary") == stat_summary(geom="xxx")</code></td>
</tr>
<tr class="odd">
<td><strong>添加拟合线</strong>
- <code>nls()</code>非线性拟合
- <code>summary()</code>查看、提取拟合结果
- <code>seq()</code>，<code>rep()</code>生成作图数据的有力工具</td>
</tr>
<tr class="even">
<td><strong>添加数学公式</strong>
- <code>annotate()</code> 往图上添加公式、文字
- <code>?plotmath</code> 查看数学公式对应的代码</td>
</tr>
<tr class="odd">
<td><strong><code>facet</code>分面功能</strong>：数据分析的世界因此而美好</td>
</tr>
<tr class="even">
<td><strong><code>for()</code>循环语句</strong>：把重复的工作交给电脑</td>
</tr>
<tr class="odd">
<td><!--chapter:end:02-ggplot.Rmd--></td>
</tr>
<tr class="even">
<td># 颜色的使用</td>
</tr>
<tr class="odd">
<td>## 颜色的使用</td>
</tr>
<tr class="even">
<td>* 离散变量-自动配色
* 离散变量-手动配色
* 连续变量-自动配色
* 连续变量-手动配色</td>
</tr>
<tr class="odd">
<td>## 离散变量-自动配色
<code>scale_color_brewer(palette=...)</code>
<code>scale_fill_brewer(palette=...)</code></td>
</tr>
<tr class="even">
<td><code>r p1 &lt;- ggplot(mpg, aes(displ, hwy, color = class))+ geom_point() p1</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-120-1.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p2 &lt;- ggplot(mpg, aes(class, fill = class))+ geom_bar() p2</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-120-2.png" width="672" /></td>
</tr>
<tr class="even">
<td>### 查看R系统自带配色
用<code>?scale_color_brewer</code>查询</td>
</tr>
<tr class="odd">
<td>* 点图–使用各种自动配色:以mpg数据为例
Qualitative（定性色）
Accent, Dark2, Paired, Pastel1, Pastel2, Set1, Set2, Set3
更适合于连续变量。适用于热图、等高线图、地图等</td>
</tr>
<tr class="even">
<td>```r
library(RColorBrewer)</td>
</tr>
<tr class="odd">
<td>RColorBrewer::brewer.pal.info
```</td>
</tr>
<tr class="even">
<td><code>##          maxcolors category colorblind ## BrBG            11      div       TRUE ## PiYG            11      div       TRUE ## PRGn            11      div       TRUE ## PuOr            11      div       TRUE ## RdBu            11      div       TRUE ## RdGy            11      div      FALSE ## RdYlBu          11      div       TRUE ## RdYlGn          11      div      FALSE ## Spectral        11      div      FALSE ## Accent           8     qual      FALSE ## Dark2            8     qual       TRUE ## Paired          12     qual       TRUE ## Pastel1          9     qual      FALSE ## Pastel2          8     qual      FALSE ## Set1             9     qual      FALSE ## Set2             8     qual       TRUE ## Set3            12     qual      FALSE ## Blues            9      seq       TRUE ## BuGn             9      seq       TRUE ## BuPu             9      seq       TRUE ## GnBu             9      seq       TRUE ## Greens           9      seq       TRUE ## Greys            9      seq       TRUE ## Oranges          9      seq       TRUE ## OrRd             9      seq       TRUE ## PuBu             9      seq       TRUE ## PuBuGn           9      seq       TRUE ## PuRd             9      seq       TRUE ## Purples          9      seq       TRUE ## RdPu             9      seq       TRUE ## Reds             9      seq       TRUE ## YlGn             9      seq       TRUE ## YlGnBu           9      seq       TRUE ## YlOrBr           9      seq       TRUE ## YlOrRd           9      seq       TRUE</code></td>
</tr>
<tr class="odd">
<td><code>r RColorBrewer::display.brewer.all()</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-121-1.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r RColorBrewer::brewer.pal.info</code></td>
</tr>
<tr class="even">
<td><code>##          maxcolors category colorblind ## BrBG            11      div       TRUE ## PiYG            11      div       TRUE ## PRGn            11      div       TRUE ## PuOr            11      div       TRUE ## RdBu            11      div       TRUE ## RdGy            11      div      FALSE ## RdYlBu          11      div       TRUE ## RdYlGn          11      div      FALSE ## Spectral        11      div      FALSE ## Accent           8     qual      FALSE ## Dark2            8     qual       TRUE ## Paired          12     qual       TRUE ## Pastel1          9     qual      FALSE ## Pastel2          8     qual      FALSE ## Set1             9     qual      FALSE ## Set2             8     qual       TRUE ## Set3            12     qual      FALSE ## Blues            9      seq       TRUE ## BuGn             9      seq       TRUE ## BuPu             9      seq       TRUE ## GnBu             9      seq       TRUE ## Greens           9      seq       TRUE ## Greys            9      seq       TRUE ## Oranges          9      seq       TRUE ## OrRd             9      seq       TRUE ## PuBu             9      seq       TRUE ## PuBuGn           9      seq       TRUE ## PuRd             9      seq       TRUE ## Purples          9      seq       TRUE ## RdPu             9      seq       TRUE ## Reds             9      seq       TRUE ## YlGn             9      seq       TRUE ## YlGnBu           9      seq       TRUE ## YlOrBr           9      seq       TRUE ## YlOrRd           9      seq       TRUE</code></td>
</tr>
<tr class="odd">
<td><code>r rownames(RColorBrewer::brewer.pal.info)</code></td>
</tr>
<tr class="even">
<td><code>##  [1] "BrBG"     "PiYG"     "PRGn"     "PuOr"     "RdBu"     "RdGy" ##  [7] "RdYlBu"   "RdYlGn"   "Spectral" "Accent"   "Dark2"    "Paired" ## [13] "Pastel1"  "Pastel2"  "Set1"     "Set2"     "Set3"     "Blues" ## [19] "BuGn"     "BuPu"     "GnBu"     "Greens"   "Greys"    "Oranges" ## [25] "OrRd"     "PuBu"     "PuBuGn"   "PuRd"     "Purples"  "RdPu" ## [31] "Reds"     "YlGn"     "YlGnBu"   "YlOrBr"   "YlOrRd"</code></td>
</tr>
<tr class="odd">
<td>### 使用R系统自带配色</td>
</tr>
<tr class="even">
<td><code>r p1 + scale_color_brewer(palette="Set1")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-122-1.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p2 + scale_fill_brewer(palette="Set1")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-122-2.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p1 + scale_color_brewer(palette="Set3")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-122-3.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p2 + scale_fill_brewer(palette="Set3")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-122-4.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p1 + scale_color_brewer(palette = "Accent")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-122-5.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p2 + scale_fill_brewer(palette = "Accent")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-122-6.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p1 + scale_color_brewer(palette = "Dark2")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-122-7.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p2 + scale_fill_brewer(palette = "Dark2")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-122-8.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p1+ scale_color_brewer(palette = "BrBG")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-122-9.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p2 + scale_fill_brewer(palette = "BrBG")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-122-10.png" width="672" /></td>
</tr>
<tr class="even">
<td>### 色盲友好的viridis配色
<code>?scale_fill_viridis_d</code></td>
</tr>
<tr class="odd">
<td><code>r p1 + scale_color_viridis_d()</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-123-1.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p2 + scale_fill_viridis_d()</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-123-2.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p1 + scale_color_viridis_d(option = "A")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-123-3.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p2 + scale_fill_viridis_d(option = "A")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-123-4.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p1 + scale_color_viridis_d(option = "B")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-123-5.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p2 + scale_fill_viridis_d(option = "B")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-123-6.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p1 + scale_color_viridis_d(option = "F")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-123-7.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p2 + scale_fill_viridis_d(option = "F")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-123-8.png" width="672" /></td>
</tr>
<tr class="odd">
<td>* 离散变量-手动配色
<code>scale_color_manual(values=...)</code>
<code>scale_fill_manual(values=...)</code></td>
</tr>
<tr class="even">
<td><code>r p1 + scale_color_manual(values=c("red","orange","yellow","green","blue","grey","black"))</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-124-1.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p2 + scale_fill_manual(values=c("red","orange","yellow","green","blue","grey","black"))</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-124-2.png" width="672" /></td>
</tr>
<tr class="even">
<td>### 如何知道各种颜色的名称？<code>colors()</code></td>
</tr>
<tr class="odd">
<td><code>r colors()</code></td>
</tr>
<tr class="even">
<td><code>##   [1] "white"                "aliceblue"            "antiquewhite" ##   [4] "antiquewhite1"        "antiquewhite2"        "antiquewhite3" ##   [7] "antiquewhite4"        "aquamarine"           "aquamarine1" ##  [10] "aquamarine2"          "aquamarine3"          "aquamarine4" ##  [13] "azure"                "azure1"               "azure2" ##  [16] "azure3"               "azure4"               "beige" ##  [19] "bisque"               "bisque1"              "bisque2" ##  [22] "bisque3"              "bisque4"              "black" ##  [25] "blanchedalmond"       "blue"                 "blue1" ##  [28] "blue2"                "blue3"                "blue4" ##  [31] "blueviolet"           "brown"                "brown1" ##  [34] "brown2"               "brown3"               "brown4" ##  [37] "burlywood"            "burlywood1"           "burlywood2" ##  [40] "burlywood3"           "burlywood4"           "cadetblue" ##  [43] "cadetblue1"           "cadetblue2"           "cadetblue3" ##  [46] "cadetblue4"           "chartreuse"           "chartreuse1" ##  [49] "chartreuse2"          "chartreuse3"          "chartreuse4" ##  [52] "chocolate"            "chocolate1"           "chocolate2" ##  [55] "chocolate3"           "chocolate4"           "coral" ##  [58] "coral1"               "coral2"               "coral3" ##  [61] "coral4"               "cornflowerblue"       "cornsilk" ##  [64] "cornsilk1"            "cornsilk2"            "cornsilk3" ##  [67] "cornsilk4"            "cyan"                 "cyan1" ##  [70] "cyan2"                "cyan3"                "cyan4" ##  [73] "darkblue"             "darkcyan"             "darkgoldenrod" ##  [76] "darkgoldenrod1"       "darkgoldenrod2"       "darkgoldenrod3" ##  [79] "darkgoldenrod4"       "darkgray"             "darkgreen" ##  [82] "darkgrey"             "darkkhaki"            "darkmagenta" ##  [85] "darkolivegreen"       "darkolivegreen1"      "darkolivegreen2" ##  [88] "darkolivegreen3"      "darkolivegreen4"      "darkorange" ##  [91] "darkorange1"          "darkorange2"          "darkorange3" ##  [94] "darkorange4"          "darkorchid"           "darkorchid1" ##  [97] "darkorchid2"          "darkorchid3"          "darkorchid4" ## [100] "darkred"              "darksalmon"           "darkseagreen" ## [103] "darkseagreen1"        "darkseagreen2"        "darkseagreen3" ## [106] "darkseagreen4"        "darkslateblue"        "darkslategray" ## [109] "darkslategray1"       "darkslategray2"       "darkslategray3" ## [112] "darkslategray4"       "darkslategrey"        "darkturquoise" ## [115] "darkviolet"           "deeppink"             "deeppink1" ## [118] "deeppink2"            "deeppink3"            "deeppink4" ## [121] "deepskyblue"          "deepskyblue1"         "deepskyblue2" ## [124] "deepskyblue3"         "deepskyblue4"         "dimgray" ## [127] "dimgrey"              "dodgerblue"           "dodgerblue1" ## [130] "dodgerblue2"          "dodgerblue3"          "dodgerblue4" ## [133] "firebrick"            "firebrick1"           "firebrick2" ## [136] "firebrick3"           "firebrick4"           "floralwhite" ## [139] "forestgreen"          "gainsboro"            "ghostwhite" ## [142] "gold"                 "gold1"                "gold2" ## [145] "gold3"                "gold4"                "goldenrod" ## [148] "goldenrod1"           "goldenrod2"           "goldenrod3" ## [151] "goldenrod4"           "gray"                 "gray0" ## [154] "gray1"                "gray2"                "gray3" ## [157] "gray4"                "gray5"                "gray6" ## [160] "gray7"                "gray8"                "gray9" ## [163] "gray10"               "gray11"               "gray12" ## [166] "gray13"               "gray14"               "gray15" ## [169] "gray16"               "gray17"               "gray18" ## [172] "gray19"               "gray20"               "gray21" ## [175] "gray22"               "gray23"               "gray24" ## [178] "gray25"               "gray26"               "gray27" ## [181] "gray28"               "gray29"               "gray30" ## [184] "gray31"               "gray32"               "gray33" ## [187] "gray34"               "gray35"               "gray36" ## [190] "gray37"               "gray38"               "gray39" ## [193] "gray40"               "gray41"               "gray42" ## [196] "gray43"               "gray44"               "gray45" ## [199] "gray46"               "gray47"               "gray48" ## [202] "gray49"               "gray50"               "gray51" ## [205] "gray52"               "gray53"               "gray54" ## [208] "gray55"               "gray56"               "gray57" ## [211] "gray58"               "gray59"               "gray60" ## [214] "gray61"               "gray62"               "gray63" ## [217] "gray64"               "gray65"               "gray66" ## [220] "gray67"               "gray68"               "gray69" ## [223] "gray70"               "gray71"               "gray72" ## [226] "gray73"               "gray74"               "gray75" ## [229] "gray76"               "gray77"               "gray78" ## [232] "gray79"               "gray80"               "gray81" ## [235] "gray82"               "gray83"               "gray84" ## [238] "gray85"               "gray86"               "gray87" ## [241] "gray88"               "gray89"               "gray90" ## [244] "gray91"               "gray92"               "gray93" ## [247] "gray94"               "gray95"               "gray96" ## [250] "gray97"               "gray98"               "gray99" ## [253] "gray100"              "green"                "green1" ## [256] "green2"               "green3"               "green4" ## [259] "greenyellow"          "grey"                 "grey0" ## [262] "grey1"                "grey2"                "grey3" ## [265] "grey4"                "grey5"                "grey6" ## [268] "grey7"                "grey8"                "grey9" ## [271] "grey10"               "grey11"               "grey12" ## [274] "grey13"               "grey14"               "grey15" ## [277] "grey16"               "grey17"               "grey18" ## [280] "grey19"               "grey20"               "grey21" ## [283] "grey22"               "grey23"               "grey24" ## [286] "grey25"               "grey26"               "grey27" ## [289] "grey28"               "grey29"               "grey30" ## [292] "grey31"               "grey32"               "grey33" ## [295] "grey34"               "grey35"               "grey36" ## [298] "grey37"               "grey38"               "grey39" ## [301] "grey40"               "grey41"               "grey42" ## [304] "grey43"               "grey44"               "grey45" ## [307] "grey46"               "grey47"               "grey48" ## [310] "grey49"               "grey50"               "grey51" ## [313] "grey52"               "grey53"               "grey54" ## [316] "grey55"               "grey56"               "grey57" ## [319] "grey58"               "grey59"               "grey60" ## [322] "grey61"               "grey62"               "grey63" ## [325] "grey64"               "grey65"               "grey66" ## [328] "grey67"               "grey68"               "grey69" ## [331] "grey70"               "grey71"               "grey72" ## [334] "grey73"               "grey74"               "grey75" ## [337] "grey76"               "grey77"               "grey78" ## [340] "grey79"               "grey80"               "grey81" ## [343] "grey82"               "grey83"               "grey84" ## [346] "grey85"               "grey86"               "grey87" ## [349] "grey88"               "grey89"               "grey90" ## [352] "grey91"               "grey92"               "grey93" ## [355] "grey94"               "grey95"               "grey96" ## [358] "grey97"               "grey98"               "grey99" ## [361] "grey100"              "honeydew"             "honeydew1" ## [364] "honeydew2"            "honeydew3"            "honeydew4" ## [367] "hotpink"              "hotpink1"             "hotpink2" ## [370] "hotpink3"             "hotpink4"             "indianred" ## [373] "indianred1"           "indianred2"           "indianred3" ## [376] "indianred4"           "ivory"                "ivory1" ## [379] "ivory2"               "ivory3"               "ivory4" ## [382] "khaki"                "khaki1"               "khaki2" ## [385] "khaki3"               "khaki4"               "lavender" ## [388] "lavenderblush"        "lavenderblush1"       "lavenderblush2" ## [391] "lavenderblush3"       "lavenderblush4"       "lawngreen" ## [394] "lemonchiffon"         "lemonchiffon1"        "lemonchiffon2" ## [397] "lemonchiffon3"        "lemonchiffon4"        "lightblue" ## [400] "lightblue1"           "lightblue2"           "lightblue3" ## [403] "lightblue4"           "lightcoral"           "lightcyan" ## [406] "lightcyan1"           "lightcyan2"           "lightcyan3" ## [409] "lightcyan4"           "lightgoldenrod"       "lightgoldenrod1" ## [412] "lightgoldenrod2"      "lightgoldenrod3"      "lightgoldenrod4" ## [415] "lightgoldenrodyellow" "lightgray"            "lightgreen" ## [418] "lightgrey"            "lightpink"            "lightpink1" ## [421] "lightpink2"           "lightpink3"           "lightpink4" ## [424] "lightsalmon"          "lightsalmon1"         "lightsalmon2" ## [427] "lightsalmon3"         "lightsalmon4"         "lightseagreen" ## [430] "lightskyblue"         "lightskyblue1"        "lightskyblue2" ## [433] "lightskyblue3"        "lightskyblue4"        "lightslateblue" ## [436] "lightslategray"       "lightslategrey"       "lightsteelblue" ## [439] "lightsteelblue1"      "lightsteelblue2"      "lightsteelblue3" ## [442] "lightsteelblue4"      "lightyellow"          "lightyellow1" ## [445] "lightyellow2"         "lightyellow3"         "lightyellow4" ## [448] "limegreen"            "linen"                "magenta" ## [451] "magenta1"             "magenta2"             "magenta3" ## [454] "magenta4"             "maroon"               "maroon1" ## [457] "maroon2"              "maroon3"              "maroon4" ## [460] "mediumaquamarine"     "mediumblue"           "mediumorchid" ## [463] "mediumorchid1"        "mediumorchid2"        "mediumorchid3" ## [466] "mediumorchid4"        "mediumpurple"         "mediumpurple1" ## [469] "mediumpurple2"        "mediumpurple3"        "mediumpurple4" ## [472] "mediumseagreen"       "mediumslateblue"      "mediumspringgreen" ## [475] "mediumturquoise"      "mediumvioletred"      "midnightblue" ## [478] "mintcream"            "mistyrose"            "mistyrose1" ## [481] "mistyrose2"           "mistyrose3"           "mistyrose4" ## [484] "moccasin"             "navajowhite"          "navajowhite1" ## [487] "navajowhite2"         "navajowhite3"         "navajowhite4" ## [490] "navy"                 "navyblue"             "oldlace" ## [493] "olivedrab"            "olivedrab1"           "olivedrab2" ## [496] "olivedrab3"           "olivedrab4"           "orange" ## [499] "orange1"              "orange2"              "orange3" ## [502] "orange4"              "orangered"            "orangered1" ## [505] "orangered2"           "orangered3"           "orangered4" ## [508] "orchid"               "orchid1"              "orchid2" ## [511] "orchid3"              "orchid4"              "palegoldenrod" ## [514] "palegreen"            "palegreen1"           "palegreen2" ## [517] "palegreen3"           "palegreen4"           "paleturquoise" ## [520] "paleturquoise1"       "paleturquoise2"       "paleturquoise3" ## [523] "paleturquoise4"       "palevioletred"        "palevioletred1" ## [526] "palevioletred2"       "palevioletred3"       "palevioletred4" ## [529] "papayawhip"           "peachpuff"            "peachpuff1" ## [532] "peachpuff2"           "peachpuff3"           "peachpuff4" ## [535] "peru"                 "pink"                 "pink1" ## [538] "pink2"                "pink3"                "pink4" ## [541] "plum"                 "plum1"                "plum2" ## [544] "plum3"                "plum4"                "powderblue" ## [547] "purple"               "purple1"              "purple2" ## [550] "purple3"              "purple4"              "red" ## [553] "red1"                 "red2"                 "red3" ## [556] "red4"                 "rosybrown"            "rosybrown1" ## [559] "rosybrown2"           "rosybrown3"           "rosybrown4" ## [562] "royalblue"            "royalblue1"           "royalblue2" ## [565] "royalblue3"           "royalblue4"           "saddlebrown" ## [568] "salmon"               "salmon1"              "salmon2" ## [571] "salmon3"              "salmon4"              "sandybrown" ## [574] "seagreen"             "seagreen1"            "seagreen2" ## [577] "seagreen3"            "seagreen4"            "seashell" ## [580] "seashell1"            "seashell2"            "seashell3" ## [583] "seashell4"            "sienna"               "sienna1" ## [586] "sienna2"              "sienna3"              "sienna4" ## [589] "skyblue"              "skyblue1"             "skyblue2" ## [592] "skyblue3"             "skyblue4"             "slateblue" ## [595] "slateblue1"           "slateblue2"           "slateblue3" ## [598] "slateblue4"           "slategray"            "slategray1" ## [601] "slategray2"           "slategray3"           "slategray4" ## [604] "slategrey"            "snow"                 "snow1" ## [607] "snow2"                "snow3"                "snow4" ## [610] "springgreen"          "springgreen1"         "springgreen2" ## [613] "springgreen3"         "springgreen4"         "steelblue" ## [616] "steelblue1"           "steelblue2"           "steelblue3" ## [619] "steelblue4"           "tan"                  "tan1" ## [622] "tan2"                 "tan3"                 "tan4" ## [625] "thistle"              "thistle1"             "thistle2" ## [628] "thistle3"             "thistle4"             "tomato" ## [631] "tomato1"              "tomato2"              "tomato3" ## [634] "tomato4"              "turquoise"            "turquoise1" ## [637] "turquoise2"           "turquoise3"           "turquoise4" ## [640] "violet"               "violetred"            "violetred1" ## [643] "violetred2"           "violetred3"           "violetred4" ## [646] "wheat"                "wheat1"               "wheat2" ## [649] "wheat3"               "wheat4"               "whitesmoke" ## [652] "yellow"               "yellow1"              "yellow2" ## [655] "yellow3"              "yellow4"              "yellowgreen"</code></td>
</tr>
<tr class="odd">
<td><code>r colors()[1:9]</code></td>
</tr>
<tr class="even">
<td><code>## [1] "white"         "aliceblue"     "antiquewhite"  "antiquewhite1" ## [5] "antiquewhite2" "antiquewhite3" "antiquewhite4" "aquamarine" ## [9] "aquamarine1"</code></td>
</tr>
<tr class="odd">
<td><code>r scales::show_col(colors()[100:108])</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-126-1.png" width="672" /></td>
</tr>
<tr class="odd">
<td>### 如何预览各种颜色？ <code>scales::show_col()</code></td>
</tr>
<tr class="even">
<td><code>r library(scales) show_col("springgreen")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-127-1.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r show_col(c("springgreen","snow4","violetred","skyblue1", "steelblue1","navy", "lightsteelblue3","turquoise2","rosybrown"))</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-127-2.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r show_col(colors()[10:20])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-127-3.png" width="672" /></td>
</tr>
<tr class="even">
<td>### 如何设置出谐调、美观、科学的配色？
去配色程序包里找，去配色网站找，去艺术品里找，去大自然找。</td>
</tr>
<tr class="odd">
<td>查看颜色的程序包</td>
</tr>
<tr class="even">
<td><code>r RColorBrewer::brewer.pal(n=8, name = "Set1")</code></td>
</tr>
<tr class="odd">
<td><code>## [1] "#E41A1C" "#377EB8" "#4DAF4A" "#984EA3" "#FF7F00" "#FFFF33" "#A65628" ## [8] "#F781BF"</code></td>
</tr>
<tr class="even">
<td><code>r mycol &lt;- RColorBrewer::brewer.pal(n=8, name = "Set1") mycol</code></td>
</tr>
<tr class="odd">
<td><code>## [1] "#E41A1C" "#377EB8" "#4DAF4A" "#984EA3" "#FF7F00" "#FFFF33" "#A65628" ## [8] "#F781BF"</code></td>
</tr>
<tr class="even">
<td>```r
show_col(mycol)</td>
</tr>
<tr class="odd">
<td>brewer.pal(8, “Set1”) #提取“Set1”配色中的颜色代码
```</td>
</tr>
<tr class="even">
<td><code>## [1] "#E41A1C" "#377EB8" "#4DAF4A" "#984EA3" "#FF7F00" "#FFFF33" "#A65628" ## [8] "#F781BF"</code></td>
</tr>
<tr class="odd">
<td><code>r show_col(brewer.pal(8, "Set1"))</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-128-1.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>ggsci</code> 配色程序包</td>
</tr>
<tr class="even">
<td>```r
library(ggsci)</td>
</tr>
<tr class="odd">
<td>ggsci::pal_aaas()(10)
```</td>
</tr>
<tr class="even">
<td><code>##  [1] "#3B4992FF" "#EE0000FF" "#008B45FF" "#631879FF" "#008280FF" "#BB0021FF" ##  [7] "#5F559BFF" "#A20056FF" "#808180FF" "#1B1919FF"</code></td>
</tr>
<tr class="odd">
<td><code>r show_col(ggsci::pal_aaas()(10))</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-1.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r ggsci::pal_npg()(10)</code></td>
</tr>
<tr class="even">
<td><code>##  [1] "#E64B35FF" "#4DBBD5FF" "#00A087FF" "#3C5488FF" "#F39B7FFF" "#8491B4FF" ##  [7] "#91D1C2FF" "#DC0000FF" "#7E6148FF" "#B09C85FF"</code></td>
</tr>
<tr class="odd">
<td><code>r show_col(ggsci::pal_npg()(10))</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-2.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r show_col(ggsci::pal_simpsons()(10))</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-3.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r ggsci::pal_aaas()(10)</code></td>
</tr>
<tr class="even">
<td><code>##  [1] "#3B4992FF" "#EE0000FF" "#008B45FF" "#631879FF" "#008280FF" "#BB0021FF" ##  [7] "#5F559BFF" "#A20056FF" "#808180FF" "#1B1919FF"</code></td>
</tr>
<tr class="odd">
<td><code>r show_col(ggsci::pal_aaas()(10))</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-4.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p1 + scale_color_aaas()</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-5.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p2 + scale_fill_aaas()</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-6.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p1 + scale_color_npg()</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-7.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p2 + scale_fill_npg()</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-8.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p1 + scale_color_manual(values=ggsci::pal_aaas()(10))</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-9.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p2 + scale_fill_manual(values=ggsci::pal_aaas()(10))</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-10.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r ggsci::pal_d3()(10)</code></td>
</tr>
<tr class="even">
<td><code>##  [1] "#1F77B4FF" "#FF7F0EFF" "#2CA02CFF" "#D62728FF" "#9467BDFF" "#8C564BFF" ##  [7] "#E377C2FF" "#7F7F7FFF" "#BCBD22FF" "#17BECFFF"</code></td>
</tr>
<tr class="odd">
<td><code>r show_col(ggsci::pal_d3()(10))</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-11.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r ggsci::pal_futurama()(10)</code></td>
</tr>
<tr class="even">
<td><code>##  [1] "#FF6F00FF" "#C71000FF" "#008EA0FF" "#8A4198FF" "#5A9599FF" "#FF6348FF" ##  [7] "#84D7E1FF" "#FF95A8FF" "#3D3B25FF" "#ADE2D0FF"</code></td>
</tr>
<tr class="odd">
<td><code>r show_col(ggsci::pal_futurama()(10))</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-12.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r ggsci::pal_gsea()(10)</code></td>
</tr>
<tr class="even">
<td><code>##  [1] "#4500ACFF" "#2600D1FF" "#6B58EEFF" "#8787FFFF" "#C6C0FFFF" "#D4D4FFFF" ##  [7] "#FFBFE5FF" "#FF8888FF" "#FF707FFF" "#FF5959FF"</code></td>
</tr>
<tr class="odd">
<td><code>r show_col(ggsci::pal_gsea()(10))</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-13.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r ggsci::pal_nejm()(10)</code></td>
</tr>
<tr class="even">
<td><code>## Warning: This manual palette can handle a maximum of 8 values. You have supplied ## 10.</code></td>
</tr>
<tr class="odd">
<td><code>##  [1] "#BC3C29FF" "#0072B5FF" "#E18727FF" "#20854EFF" "#7876B1FF" "#6F99ADFF" ##  [7] "#FFDC91FF" "#EE4C97FF" NA          NA</code></td>
</tr>
<tr class="even">
<td><code>r show_col(ggsci::pal_nejm()(10))</code></td>
</tr>
<tr class="odd">
<td><code>## Warning: This manual palette can handle a maximum of 8 values. You have supplied ## 10.</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-14.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r ggsci::pal_npg()(10)</code></td>
</tr>
<tr class="even">
<td><code>##  [1] "#E64B35FF" "#4DBBD5FF" "#00A087FF" "#3C5488FF" "#F39B7FFF" "#8491B4FF" ##  [7] "#91D1C2FF" "#DC0000FF" "#7E6148FF" "#B09C85FF"</code></td>
</tr>
<tr class="odd">
<td><code>r show_col(ggsci::pal_npg()(10))</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-129-15.png" width="672" /></td>
</tr>
<tr class="odd">
<td>去大自然里找，去生活里找</td>
</tr>
<tr class="even">
<td><code>r pal_cee &lt;- c("#DA1718", "#CE9F9F", "#36536D", "#5092E1", "#D8E8F9", "#526B13",  "#97B325", "#876454", "#C0C0CC") show_col(pal_cee)</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-130-1.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p1 + scale_color_manual(values=pal_cee)</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-130-2.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p2 + scale_fill_manual(values=pal_cee)</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-130-3.png" width="672" /></td>
</tr>
<tr class="even">
<td>去艺术品里找</td>
</tr>
<tr class="odd">
<td><code>r pal_qljs &lt;- c("#1F394D", "#EEC979", "#C4CBC2", "#5A6683", "#BB9555", "#CDE5BC", "#356183", "#24211F", "#E9C3BC") show_col(pal_qljs)</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-131-1.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p1 + scale_color_manual(values=pal_qljs)</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-131-2.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p2 + scale_fill_manual(values = pal_qljs)</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-131-3.png" width="672" /></td>
</tr>
<tr class="odd">
<td>* 网站配色
<a href="https://coolors.co/" class="uri">https://coolors.co/</a>
5种颜色一组，地址栏直接获取Hex颜色代码</td>
</tr>
<tr class="even">
<td><a href="https://medialab.github.io/iwanthue/" class="uri">https://medialab.github.io/iwanthue/</a>
颜色数量较多时自动配色</td>
</tr>
<tr class="odd">
<td>* Pantone配色</td>
</tr>
<tr class="even">
<td>```r
Pantone &lt;- c(“#34558b,” “#d13b40,” “#ffaf12,” “#4ec5a5,” “#565d47,” “#798fa8,” “#fd823e,” “#117893,” “#f0daa4,” “#eaac9d,” “#a2553a,” “#72617d,” “#b49c73,” “#3b3d4b,” “#eff0f1,” “#a09d9c,” “#191970,” “#bc243c,” “#585ea6,” “#F5DF4D”)</td>
</tr>
<tr class="odd">
<td>show_col(Pantone)
```</td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-132-1.png" width="672" /></td>
</tr>
<tr class="odd">
<td>## 连续变量-自动配色
<code>scale_color_distiller(palette=...)</code>
<code>scale_fill_distiller(palette=...)</code></td>
</tr>
<tr class="even">
<td>代码：颜色映射到连续变量
scale_fill_distiller(palette=…) 利用系统的配色方案插值得到连续配色，常用</td>
</tr>
<tr class="odd">
<td>```r
d2 &lt;- tidyr::crossing(x = seq(-10, 10, 0.1), y = seq(-10, 10, 0.1)) %&gt;%
mutate(z = sin(sin(x * (sin(y) - cos(x)))) - cos(cos(y * (cos(x) - sin(y)))))</td>
</tr>
<tr class="even">
<td>p &lt;- ggplot(d2, aes(x, y)) +
geom_raster(aes(fill = z))
p
```</td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-133-1.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p &lt;- p + coord_equal() p</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-133-2.png" width="672" /></td>
</tr>
<tr class="even">
<td>Sequential（渐变色）
Blues, BuGn, BuPu, GnBu, Greens, Greys, Oranges, OrRd, PuBu, PuBuGn, PuRd, Purples, RdPu, Reds, YlGn, YlGnBu, YlOrBr, YlOrRd</td>
</tr>
<tr class="odd">
<td>Diverging（分裂色）
BrBG, PiYG, PRGn, PuOr, RdBu, RdGy, RdYlBu, RdYlGn, Spectral</td>
</tr>
<tr class="even">
<td><code>scale_color_brewer(palette =...)</code> 使用自动配色方案，常用
<code>scale_color_manual(values = c(...))</code> 手动配色，常用</td>
</tr>
<tr class="odd">
<td>### 自动配色</td>
</tr>
<tr class="even">
<td><code>r RColorBrewer::brewer.pal.info</code></td>
</tr>
<tr class="odd">
<td><code>##          maxcolors category colorblind ## BrBG            11      div       TRUE ## PiYG            11      div       TRUE ## PRGn            11      div       TRUE ## PuOr            11      div       TRUE ## RdBu            11      div       TRUE ## RdGy            11      div      FALSE ## RdYlBu          11      div       TRUE ## RdYlGn          11      div      FALSE ## Spectral        11      div      FALSE ## Accent           8     qual      FALSE ## Dark2            8     qual       TRUE ## Paired          12     qual       TRUE ## Pastel1          9     qual      FALSE ## Pastel2          8     qual      FALSE ## Set1             9     qual      FALSE ## Set2             8     qual       TRUE ## Set3            12     qual      FALSE ## Blues            9      seq       TRUE ## BuGn             9      seq       TRUE ## BuPu             9      seq       TRUE ## GnBu             9      seq       TRUE ## Greens           9      seq       TRUE ## Greys            9      seq       TRUE ## Oranges          9      seq       TRUE ## OrRd             9      seq       TRUE ## PuBu             9      seq       TRUE ## PuBuGn           9      seq       TRUE ## PuRd             9      seq       TRUE ## Purples          9      seq       TRUE ## RdPu             9      seq       TRUE ## Reds             9      seq       TRUE ## YlGn             9      seq       TRUE ## YlGnBu           9      seq       TRUE ## YlOrBr           9      seq       TRUE ## YlOrRd           9      seq       TRUE</code></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_distiller(palette = "BrBG")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-134-1.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_distiller(palette = "PiYG")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-134-2.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_distiller(palette = "Accent")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-134-3.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_distiller(palette = "PuBu")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-134-4.png" width="672" /></td>
</tr>
<tr class="even">
<td>系统自带色盲友好<code>viridis</code>配色</td>
</tr>
<tr class="odd">
<td><code>r p + scale_fill_viridis_c(option = "A")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-135-1.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p + scale_fill_viridis_c(option = "B")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-135-2.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p + scale_fill_viridis_c(option = "C")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-135-3.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p + scale_fill_viridis_c(option = "D")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-135-4.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p + scale_fill_viridis_c(option = "E")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-135-5.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p + scale_fill_viridis_c(option = "F")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-135-6.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p + scale_fill_viridis_c(option = "G")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-135-7.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p + scale_fill_viridis_c(option = "H")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-135-8.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p + scale_fill_viridis_c(option = "I")</code></td>
</tr>
<tr class="even">
<td><code>## Warning in viridisLite::viridis(n, alpha, begin, end, direction, option): Option ## 'I' does not exist. Defaulting to 'viridis'.</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-135-9.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>scico</code>程序包，科学的渐变色</td>
</tr>
<tr class="odd">
<td>```r
library(scico)</td>
</tr>
<tr class="even">
<td>scico::scico_palette_names()
```</td>
</tr>
<tr class="odd">
<td><code>##  [1] "acton"   "bam"     "bamako"  "bamO"    "batlow"  "batlowK" "batlowW" ##  [8] "berlin"  "bilbao"  "broc"    "brocO"   "buda"    "bukavu"  "cork" ## [15] "corkO"   "davos"   "devon"   "fes"     "grayC"   "hawaii"  "imola" ## [22] "lajolla" "lapaz"   "lisbon"  "nuuk"    "oleron"  "oslo"    "roma" ## [29] "romaO"   "tofino"  "tokyo"   "turku"   "vanimo"  "vik"     "vikO"</code></td>
</tr>
<tr class="even">
<td><code>r scico::scale_fill_scico(palette = "buda")</code></td>
</tr>
<tr class="odd">
<td><code>## &lt;ScaleContinuous&gt; ##  Range: ##  Limits:    0 --    1</code></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = "buda")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-1.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = "batlow")</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-2.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r scico_names &lt;- scico::scico_palette_names() scico_names</code></td>
</tr>
<tr class="odd">
<td><code>##  [1] "acton"   "bam"     "bamako"  "bamO"    "batlow"  "batlowK" "batlowW" ##  [8] "berlin"  "bilbao"  "broc"    "brocO"   "buda"    "bukavu"  "cork" ## [15] "corkO"   "davos"   "devon"   "fes"     "grayC"   "hawaii"  "imola" ## [22] "lajolla" "lapaz"   "lisbon"  "nuuk"    "oleron"  "oslo"    "roma" ## [29] "romaO"   "tofino"  "tokyo"   "turku"   "vanimo"  "vik"     "vikO"</code></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[1])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-3.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[2])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-4.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[3])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-5.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[4])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-6.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[5])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-7.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[6])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-8.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[7])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-9.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[8])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-10.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[9])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-11.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[10])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-12.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[11])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-13.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[12])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-14.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[13])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-15.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[14])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-16.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[15])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-17.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r p + scale_fill_scico(palette = scico_names[16])</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-136-18.png" width="672" /></td>
</tr>
<tr class="even">
<td>## 连续变量-手动配色
颜色映射到连续变量
<code>scale_color_gradient(low=..., high=..., na.value=)</code> 用两种颜色形成梯度
<code>scale_color_continuous(low=..., high=...)</code> 同上
<code>scale_color_gradient2(low=..., mid=..., high=...)</code>用三种颜色形成梯度</td>
</tr>
<tr class="odd">
<td><code>r p + scale_fill_gradient(low = "white", high = "black", na.value = "grey96")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-137-1.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>scale_color_gradientn(colors=...)</code> 用n种颜色形成梯度</td>
</tr>
<tr class="even">
<td>heat.colors(8)
terrain.colors(8)</td>
</tr>
<tr class="odd">
<td><code>r p + scale_fill_gradientn(colors=heat.colors(8), na.value="white")</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-138-1.png" width="672" /></td>
</tr>
<tr class="odd">
<td>## 颜色RGB码的转化</td>
</tr>
<tr class="even">
<td><code>r rgb(34, 108, 224, max=255)</code></td>
</tr>
<tr class="odd">
<td><code>## [1] "#226CE0"</code></td>
</tr>
<tr class="even">
<td>## 推荐阅读：
科技论文中颜色的误用
Crameri, F., Shephard, G. E., &amp; Heron, P. J. (2020). The misuse of colour in science communication. Nature communications, 11(1), 1-10.
<a href="https://www.nature.com/articles/s41467-020-19160-7" class="uri">https://www.nature.com/articles/s41467-020-19160-7</a></td>
</tr>
<tr class="odd">
<td>如何配色
The Elements of Choosing Colors for Great Data Visualization in R
<a href="http://www.sthda.com/english/wiki/the-elements-of-choosing-colors-for-great-data-visualization-in-r" class="uri">http://www.sthda.com/english/wiki/the-elements-of-choosing-colors-for-great-data-visualization-in-r</a></td>
</tr>
<tr class="even">
<td>配色工具
R package colortools
<a href="https://rpubs.com/gaston/colortools" class="uri">https://rpubs.com/gaston/colortools</a></td>
</tr>
<tr class="odd">
<td>颜色使用需考虑什么
What to consider when choosing colors for data visualization
<a href="https://blog.datawrapper.de/colors/" class="uri">https://blog.datawrapper.de/colors/</a></td>
</tr>
<tr class="even">
<td>检测配色是否色盲友好
HOW TO STIMULATE COLORBLINDNESS VISION IN R FIGURES
<a href="https://www.datanovia.com/en/blog/how-to-stimulate-colorblindness-vision-in-r-figures/" class="uri">https://www.datanovia.com/en/blog/how-to-stimulate-colorblindness-vision-in-r-figures/</a></td>
</tr>
<tr class="odd">
<td>关于颜色的选择：定性vs定量，单渐变色vs双渐变色，分类vs不分类
<a href="https://blog.datawrapper.de/which-color-scale-to-use-in-data-vis/" class="uri">https://blog.datawrapper.de/which-color-scale-to-use-in-data-vis/</a></td>
</tr>
<tr class="even">
<td>### 拼图程序包 <code>cowplot</code></td>
</tr>
<tr class="odd">
<td><code>r p1</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-140-1.png" width="672" /></td>
</tr>
<tr class="odd">
<td><code>r p2</code></td>
</tr>
<tr class="even">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-140-2.png" width="672" /></td>
</tr>
<tr class="odd">
<td>```r
library(cowplot)</td>
</tr>
<tr class="even">
<td>cowplot::plot_grid(p1, p2)
```</td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-140-3.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r cowplot::plot_grid(p1, p2, p1, p2,ncol=2, labels=c("a","b","c","d"))</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-140-4.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r cowplot::plot_grid(p1, p2)</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-140-5.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r cowplot::plot_grid(p1, p2, ncol=1)</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-140-6.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r cowplot::plot_grid(p1, p2, labels = c("a","b"))</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-140-7.png" width="672" /></td>
</tr>
<tr class="even">
<td><code>r cowplot::plot_grid(p1, p2, rel_widths = c(1,2))</code></td>
</tr>
<tr class="odd">
<td><img src="bookdown-demo_files/figure-html/unnamed-chunk-140-8.png" width="672" /></td>
</tr>
<tr class="even">
<td><!--chapter:end:02b-color.Rmd--></td>
</tr>
<tr class="odd">
<td># 数据整理</td>
</tr>
<tr class="even">
<td>## 数据整理
### 3个常用的程序包<code>dplyr</code>，<code>tidyr</code>，<code>reshape2</code></td>
</tr>
<tr class="odd">
<td>Package | 常用函数
————|——————————————–
<code>dplyr</code> | <code>select()</code>，<code>filter()</code>，<code>mutate()</code>，<code>arrange()</code>
|<code>group_by()</code>，<code>summarise()</code>
| <code>join()</code>，<code>%&gt;%</code>（pipe运算符）
<code>tidyr</code> | <code>pivot_longer</code>，<code>pivot_wider()</code>
<code>reshape2</code> | <code>melt()</code>（老但好用）</td>
</tr>
<tr class="even">
<td>## <code>dplyr</code>名字的含义</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/tidyverse/dplyr/issues/1857" class="uri">https://github.com/tidyverse/dplyr/issues/1857</a></td>
</tr>
<tr class="even">
<td>hadley commented on 26 May 2016
- The d is for dataframes, the plyr is to evoke pliers. Pronounce however you like.</td>
</tr>
<tr class="odd">
<td><span class="citation">(<a href="#ref-kartiksubbarao" role="doc-biblioref"><strong>kartiksubbarao?</strong></a>)</span>
- kartiksubbarao commented on 30 Oct 2017
The precursor to dplyr was called plyr. The ‘ply’ in plyr comes from an expansion/refining of the various “apply” functions in R as part of the “split-apply-combine” model/strategy. Here’s a good slideset that provides more insight into the plyr name:</td>
</tr>
<tr class="even">
<td><a href="https://www.slideshare.net/hadley/plyr-one-data-analytic-strategy" class="uri">https://www.slideshare.net/hadley/plyr-one-data-analytic-strategy</a></td>
</tr>
<tr class="odd">
<td>## <code>tidyverse</code>大程序包</td>
</tr>
<tr class="even">
<td><strong>1. <code>ggplot2</code>，<code>dplyr</code>，<code>tidyr</code>等都是<code>tidyverse</code>系列的</strong>
<strong>2. 运行<code>install.packages("tidyverse")</code>可以一并安装</strong></td>
</tr>
<tr class="odd">
<td>### <code>tidyverse</code>包括以下程序包：</td>
</tr>
<tr class="even">
<td><code>##  [1] "broom"         "cli"           "crayon"        "dbplyr" ##  [5] "dplyr"         "dtplyr"        "forcats"       "googledrive" ##  [9] "googlesheets4" "ggplot2"       "haven"         "hms" ## [13] "httr"          "jsonlite"      "lubridate"     "magrittr" ## [17] "modelr"        "pillar"        "purrr"         "readr" ## [21] "readxl"        "reprex"        "rlang"         "rstudioapi" ## [25] "rvest"         "stringr"       "tibble"        "tidyr" ## [29] "xml2"          "tidyverse"</code></td>
</tr>
<tr class="odd">
<td>## 案例分析：美国贻贝观察数据</td>
</tr>
<tr class="even">
<td>### NOAA’s National Status and Trends###
### NS&amp;T is comprised of three nationwide programs, Benthic Surveillance, .red[Mussel Watch] and Bioeffects that are designed to describe the current status of, and detect changes in, the environmental quality of our nation’s .red[estuarine and coastal waters] through environmental monitoring, assessment and related research.###</td>
</tr>
<tr class="odd">
<td><a href="https://products.coastalscience.noaa.gov/collections/ltmonitoring/nsandt/">数据来源：https://products.coastalscience.noaa.gov/collections/ltmonitoring/nsandt/</a></td>
</tr>
<tr class="even">
<td>### 初步了解数据</td>
</tr>
<tr class="odd">
<td>- <strong>已从NOAA网站下载数据，将其命名为.red[“MusselWatch20170718.csv”]</strong></td>
</tr>
<tr class="even">
<td>- <strong>读取数据</strong></td>
</tr>
<tr class="odd">
<td><code>r d0 &lt;- read.csv("data/MusselWatch20170718.csv")</code></td>
</tr>
<tr class="even">
<td>- <strong>多少行，多少列?</strong></td>
</tr>
<tr class="odd">
<td><code>r dim(d0)</code></td>
</tr>
<tr class="even">
<td><code>## [1] 127743     16</code></td>
</tr>
<tr class="odd">
<td>有127743行，用excel处理会很棘手</td>
</tr>
<tr class="even">
<td>- <strong>各列的名称是什么？</strong></td>
</tr>
<tr class="odd">
<td><code>r names(d0)</code></td>
</tr>
<tr class="even">
<td><code>##  [1] "Study"             "NST_Site"          "General_Location" ##  [4] "Specific_Location" "Sample_ID"         "Latitude" ##  [7] "Longitude"         "Fiscal_Year"       "Collection_Date" ## [10] "Matrix"            "Scientific_Name"   "Method" ## [13] "Parameter"         "Value"             "Qualifier" ## [16] "Unit"</code></td>
</tr>
<tr class="odd">
<td>### 测定了哪些类型的样品？</td>
</tr>
<tr class="even">
<td><code>r unique(d0$Matrix)</code></td>
</tr>
<tr class="odd">
<td><code>##  [1] "Sediment"            "Water"               "Fish Filet" ##  [4] "Fish Liver"          "Sediment Trap"       "Nepheloid" ##  [7] "Oyster"              "Coral"               "Mussel" ## [10] "Fish Muscle"         "Clam"                "Cockles" ## [13] "Conch"               "Zebra Mussel Tissue" "Starfish" ## [16] "Flatfish"            "Shrimp"              "Fish" ## [19] "Lobster"</code></td>
</tr>
<tr class="even">
<td>### 测定了哪些污染物？</td>
</tr>
<tr class="odd">
<td><code>r unique(d0$Parameter)</code></td>
</tr>
<tr class="even">
<td><code>##  [1] "Aluminum"                        "Antimony" ##  [3] "Arsenic"                         "Cadmium" ##  [5] "Chromium"                        "Copper" ##  [7] "Iron"                            "Lead" ##  [9] "Manganese"                       "Mercury" ## [11] "Nickel"                          "Selenium" ## [13] "Silver"                          "Tin" ## [15] "Zinc"                            "Silicon" ## [17] "Thallium"                        "Methyl Mercury" ## [19] "Aluminum - Units in Wet Weight"  "Antimony - Units in Wet Weight" ## [21] "Arsenic - Units in Wet Weight"   "Barium - Units in Wet Weight" ## [23] "Beryllium - Units in Wet Weight" "Cadmium - Units in Wet Weight" ## [25] "Chromium - Units in Wet Weight"  "Cobalt - Units in Wet Weight" ## [27] "Copper - Units in Wet Weight"    "Iron - Units in Wet Weight" ## [29] "Lead - Units in Wet Weight"      "Lithium - Units in Wet Weight" ## [31] "Manganese - Units in Wet Weight" "Mercury - Units in Wet Weight" ## [33] "Nickel - Units in Wet Weight"    "Selenium - Units in Wet Weight" ## [35] "Silver - Units in Wet Weight"    "Thallium - Units in Wet Weight" ## [37] "Tin - Units in Wet Weight"       "Uranium - Units in Wet Weight" ## [39] "Vanadium - Units in Wet Weight"  "Zinc - Units in Wet Weight"</code></td>
</tr>
<tr class="odd">
<td>### 数据的单位是什么？</td>
</tr>
<tr class="even">
<td><code>r unique(d0$Unit)</code></td>
</tr>
<tr class="odd">
<td><code>## [1] "micrograms per dry gram  " "micrograms per wet gram"</code></td>
</tr>
<tr class="even">
<td>注意：有两种单位，后续分析时需小心，不能把不同单位的数据混在一起分析</td>
</tr>
<tr class="odd">
<td>## 提出问题</td>
</tr>
<tr class="even">
<td>### 1. 牡蛎和贻贝谁的Cd浓度高？
### 2. Zn浓度高的牡蛎，是否Cd浓度也高？</td>
</tr>
<tr class="odd">
<td><br></td>
</tr>
</tbody>
</table>
</div>
<div id="目前的数据存在哪些问题" class="section level2 hasAnchor" number="2.38">
<h2><span class="header-section-number">2.38</span> 目前的数据存在哪些问题：<a href="03-dplyr.html#目前的数据存在哪些问题" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="数据太大冗余信息过多" class="section level3 hasAnchor" number="2.38.1">
<h3><span class="header-section-number">2.38.1</span> 1. 数据太大，冗余信息过多<a href="03-dplyr.html#数据太大冗余信息过多" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>–</p>
</div>
<div id="存在干重湿重两种不同的单位" class="section level3 hasAnchor" number="2.38.2">
<h3><span class="header-section-number">2.38.2</span> 2. 存在干重、湿重两种不同的单位<a href="03-dplyr.html#存在干重湿重两种不同的单位" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="整理数据用select筛选数据的特定列" class="section level2 hasAnchor" number="2.39">
<h2><span class="header-section-number">2.39</span> 整理数据：用<code>select()</code>筛选数据的特定列<a href="03-dplyr.html#整理数据用select筛选数据的特定列" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="使用列名来选择列" class="section level3 hasAnchor" number="2.39.1">
<h3><span class="header-section-number">2.39.1</span> 使用“列名”来选择列<a href="03-dplyr.html#使用列名来选择列" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="03-dplyr.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb276-2"><a href="03-dplyr.html#cb276-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d0 <span class="sc">%&gt;%</span></span>
<span id="cb276-3"><a href="03-dplyr.html#cb276-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Fiscal_Year, Matrix, Scientific_Name, Parameter, Value, Unit) </span></code></pre></div>
<ul>
<li>检查一下结果是否符合预期：</li>
</ul>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="03-dplyr.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d)</span></code></pre></div>
<pre><code>## [1] &quot;Fiscal_Year&quot;     &quot;Matrix&quot;          &quot;Scientific_Name&quot; &quot;Parameter&quot;      
## [5] &quot;Value&quot;           &quot;Unit&quot;</code></pre>
</div>
<div id="也可以用列号进行选择" class="section level3 hasAnchor" number="2.39.2">
<h3><span class="header-section-number">2.39.2</span> 也可以用“列号”进行选择<a href="03-dplyr.html#也可以用列号进行选择" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>选择数据<code>d0</code>的第8， 10， 14， 16列，存入<code>d1</code></li>
</ul>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="03-dplyr.html#cb279-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d0 <span class="sc">%&gt;%</span></span>
<span id="cb279-2"><a href="03-dplyr.html#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">14</span>, <span class="dv">16</span>)</span></code></pre></div>
<p>删去数据<code>d0</code>的第1-7列，第9，15列，存入<code>d2</code></p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="03-dplyr.html#cb280-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d0 <span class="sc">%&gt;%</span></span>
<span id="cb280-2"><a href="03-dplyr.html#cb280-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">15</span>))</span></code></pre></div>
</div>
</div>
<div id="数据整理-用filter筛选数据的特定行" class="section level2 hasAnchor" number="2.40">
<h2><span class="header-section-number">2.40</span> 数据整理： 用<code>filter()</code>筛选数据的特定行<a href="03-dplyr.html#数据整理-用filter筛选数据的特定行" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="筛选出牡蛎和贻贝的数据" class="section level3 hasAnchor" number="2.40.1">
<h3><span class="header-section-number">2.40.1</span> 筛选出牡蛎和贻贝的数据<a href="03-dplyr.html#筛选出牡蛎和贻贝的数据" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="03-dplyr.html#cb281-1" aria-hidden="true" tabindex="-1"></a>d_oy.mu <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb281-2"><a href="03-dplyr.html#cb281-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Matrix <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Oyster&quot;</span>, <span class="st">&quot;Mussel&quot;</span>)) <span class="co">#&lt;&lt;</span></span></code></pre></div>
<p><br></p>
<p>注意：筛选多个变量用”<code>%in%</code>“，筛选单一变量用”<code>==</code>“。</p>
</div>
<div id="检查一下新的数据" class="section level3 hasAnchor" number="2.40.2">
<h3><span class="header-section-number">2.40.2</span> 检查一下新的数据<a href="03-dplyr.html#检查一下新的数据" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="03-dplyr.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(d_oy.mu)  <span class="co">#行数大为精简</span></span></code></pre></div>
<pre><code>## [1] 49360     6</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="03-dplyr.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(d_oy.mu<span class="sc">$</span>Matrix)  <span class="co">#只剩下Oyster和Mussel</span></span></code></pre></div>
<pre><code>## [1] &quot;Oyster&quot; &quot;Mussel&quot;</code></pre>
</div>
<div id="再次查看数据的单位" class="section level3 hasAnchor" number="2.40.3">
<h3><span class="header-section-number">2.40.3</span> 再次查看数据的单位<a href="03-dplyr.html#再次查看数据的单位" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="03-dplyr.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(d_oy.mu<span class="sc">$</span>Unit)</span></code></pre></div>
<pre><code>## [1] &quot;micrograms per dry gram  &quot;</code></pre>
<p>数据全部是基于干重的了，可以解除警报</p>
</div>
<div id="也可以用base-r的subset筛选数据" class="section level3 hasAnchor" number="2.40.4">
<h3><span class="header-section-number">2.40.4</span> 也可以用base R的<code>subset()</code>筛选数据<a href="03-dplyr.html#也可以用base-r的subset筛选数据" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>代码如下：</li>
</ul>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="03-dplyr.html#cb288-1" aria-hidden="true" tabindex="-1"></a>d_oy_2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(d, Matrix<span class="sc">==</span><span class="st">&quot;Oyster&quot;</span>) </span>
<span id="cb288-2"><a href="03-dplyr.html#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(d_oy_2<span class="sc">$</span>Matrix)</span></code></pre></div>
<pre><code>## [1] &quot;Oyster&quot;</code></pre>
<p><br></p>
<p>此操作简洁快速，适用于筛选步骤不多的场合</p>
</div>
</div>
<div id="注意区分filter和select" class="section level2 hasAnchor" number="2.41">
<h2><span class="header-section-number">2.41</span> 注意区分<code>filter()</code>和<code>select()</code><a href="03-dplyr.html#注意区分filter和select" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>filter()</code> 用于选择特定的行（即样品、观察)</p>
<p><code>select()</code> 用于选择特定的列（即变量)</p>
<div id="筛选出cd的数据" class="section level3 hasAnchor" number="2.41.1">
<h3><span class="header-section-number">2.41.1</span> 筛选出Cd的数据<a href="03-dplyr.html#筛选出cd的数据" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="03-dplyr.html#cb290-1" aria-hidden="true" tabindex="-1"></a>d_oy.mu_Cd <span class="ot">&lt;-</span> d_oy.mu <span class="sc">%&gt;%</span></span>
<span id="cb290-2"><a href="03-dplyr.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( Parameter <span class="sc">==</span> <span class="st">&quot;Cadmium&quot;</span>)</span></code></pre></div>
<ul>
<li>再检查数据</li>
</ul>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="03-dplyr.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(d_oy.mu_Cd)</span></code></pre></div>
<pre><code>## [1] 3579    6</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="03-dplyr.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(d_oy.mu_Cd<span class="sc">$</span>Parameter)</span></code></pre></div>
<pre><code>## [1] &quot;Cadmium&quot;</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="03-dplyr.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(d_oy.mu_Cd<span class="sc">$</span>Scientific_Name)</span></code></pre></div>
<pre><code>## [1] &quot;Crassostrea virginica&quot;   &quot;Mytilus edulis&quot;         
## [3] &quot;Mytilus species&quot;         &quot;Ostrea sandvicensis&quot;    
## [5] &quot;Geukensia demissa&quot;       &quot;Crassostrea rhizophorae&quot;
## [7] &quot;Crassostrea gigas&quot;</code></pre>
<p>发现牡蛎、贻贝共有7个物种，我们把问题1细化到物种</p>
</div>
<div id="可以作个图看看数据了" class="section level3 hasAnchor" number="2.41.2">
<h3><span class="header-section-number">2.41.2</span> 可以作个图看看数据了<a href="03-dplyr.html#可以作个图看看数据了" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>作散点图</li>
</ul>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="03-dplyr.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb297-2"><a href="03-dplyr.html#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_oy.mu_Cd, <span class="fu">aes</span>(Scientific_Name, Value))<span class="sc">+</span></span>
<span id="cb297-3"><a href="03-dplyr.html#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-159-1.png" width="672" /></p>
<p>###修改成对数坐标###</p>
<p>当数据之间差异很大时，可以考虑用对数坐标，使数据均匀分散开</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="03-dplyr.html#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_oy.mu_Cd, <span class="fu">aes</span>(Scientific_Name, Value))<span class="sc">+</span></span>
<span id="cb298-2"><a href="03-dplyr.html#cb298-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb298-3"><a href="03-dplyr.html#cb298-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_y_log10</span>()</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-160-1.png" width="672" /></p>
</div>
<div id="去掉只有2个数据点的物种" class="section level3 hasAnchor" number="2.41.3">
<h3><span class="header-section-number">2.41.3</span> 去掉只有2个数据点的物种<a href="03-dplyr.html#去掉只有2个数据点的物种" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="03-dplyr.html#cb300-1" aria-hidden="true" tabindex="-1"></a>d_Cd <span class="ot">&lt;-</span> d_oy.mu_Cd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Scientific_Name <span class="sc">!=</span> <span class="st">&quot;Crassostrea gigas&quot;</span>)</span>
<span id="cb300-2"><a href="03-dplyr.html#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_Cd, <span class="fu">aes</span>(Scientific_Name, Value))<span class="sc">+</span></span>
<span id="cb300-3"><a href="03-dplyr.html#cb300-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb300-4"><a href="03-dplyr.html#cb300-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()<span class="sc">+</span></span>
<span id="cb300-5"><a href="03-dplyr.html#cb300-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">20</span>, <span class="at">hjust=</span><span class="dv">1</span>)) <span class="co">#x轴上名称太长，旋转20°以便显示</span></span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-161-1.png" width="672" /></p>
</div>
<div id="研究问题1牡蛎贻贝谁的cd浓度高" class="section level3 hasAnchor" number="2.41.4">
<h3><span class="header-section-number">2.41.4</span> 研究问题1：牡蛎、贻贝，谁的Cd浓度高？<a href="03-dplyr.html#研究问题1牡蛎贻贝谁的cd浓度高" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>用不同颜色区分牡蛎和贻贝</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="03-dplyr.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_Cd, <span class="fu">aes</span>(Scientific_Name, Value, <span class="at">color=</span>Matrix))<span class="sc">+</span></span>
<span id="cb302-2"><a href="03-dplyr.html#cb302-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb302-3"><a href="03-dplyr.html#cb302-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_log10</span>()<span class="sc">+</span></span>
<span id="cb302-4"><a href="03-dplyr.html#cb302-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">20</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>
</div>
<div id="按中位值排序" class="section level3 hasAnchor" number="2.41.5">
<h3><span class="header-section-number">2.41.5</span> 按中位值排序<a href="03-dplyr.html#按中位值排序" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>原先的顺序无规律，不便于传达信息</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="03-dplyr.html#cb304-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(d_Cd, <span class="fu">aes</span>(<span class="fu">reorder</span>(Scientific_Name, <span class="sc">-</span>Value, median), Value, <span class="at">color=</span>Matrix))<span class="sc">+</span></span>
<span id="cb304-2"><a href="03-dplyr.html#cb304-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb304-3"><a href="03-dplyr.html#cb304-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()<span class="sc">+</span></span>
<span id="cb304-4"><a href="03-dplyr.html#cb304-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">20</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-163-1.png" width="672" /></p>
</div>
<div id="按中位值排序-1" class="section level3 hasAnchor" number="2.41.6">
<h3><span class="header-section-number">2.41.6</span> 按中位值排序<a href="03-dplyr.html#按中位值排序-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>用到了<code>reorder()</code>函数按照中位数降序排列，你可以<code>reorder()</code>看看这个函数的用法，思考：按照均值升序如何排列？</p></li>
<li><p>还有另外一种更容易理解的手动排序方法，即从图上观察高低顺序，然后按顺序排列。这种方法很常用。代码如下：</p></li>
</ul>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="03-dplyr.html#cb306-1" aria-hidden="true" tabindex="-1"></a>d_Cd<span class="sc">$</span>Scientific_Name <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb306-2"><a href="03-dplyr.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  d_Cd<span class="sc">$</span>Scientific_Name,</span>
<span id="cb306-3"><a href="03-dplyr.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb306-4"><a href="03-dplyr.html#cb306-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Mytilus species&quot;</span>,</span>
<span id="cb306-5"><a href="03-dplyr.html#cb306-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Crassostrea virginica&quot;</span>,</span>
<span id="cb306-6"><a href="03-dplyr.html#cb306-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Mytilus edulis&quot;</span>,</span>
<span id="cb306-7"><a href="03-dplyr.html#cb306-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Geukensia demissa&quot;</span>,</span>
<span id="cb306-8"><a href="03-dplyr.html#cb306-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Ostrea sandvicensis&quot;</span>,</span>
<span id="cb306-9"><a href="03-dplyr.html#cb306-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Crassostrea rhizophorae&quot;</span>))</span></code></pre></div>
</div>
<div id="修饰细节-1" class="section level3 hasAnchor" number="2.41.7">
<h3><span class="header-section-number">2.41.7</span> 修饰细节<a href="03-dplyr.html#修饰细节-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>数据点较多时，可以用小提琴图展现数据的分布，用抖动点充分展现原始数据</li>
<li>颜色的使用考虑色盲读者，考虑黑白打印</li>
</ul>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="03-dplyr.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggbeeswarm) <span class="co">#作蜂群图需要</span></span>
<span id="cb307-2"><a href="03-dplyr.html#cb307-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_Cd, <span class="fu">aes</span>(<span class="fu">reorder</span>(Scientific_Name, <span class="sc">-</span>Value, median), Value, <span class="at">color=</span>Matrix))<span class="sc">+</span></span>
<span id="cb307-3"><a href="03-dplyr.html#cb307-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb307-4"><a href="03-dplyr.html#cb307-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_violin</span>(<span class="at">draw_quantiles =</span> <span class="fl">0.5</span>)<span class="sc">+</span> <span class="co">#小提琴图</span></span>
<span id="cb307-5"><a href="03-dplyr.html#cb307-5" aria-hidden="true" tabindex="-1"></a> <span class="co">#geom_beeswarm(cex = 0.4, shape = &quot;.&quot;, size = 3, alpha = 0.5)+ #蜂群图</span></span>
<span id="cb307-6"><a href="03-dplyr.html#cb307-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">shape=</span><span class="st">&quot;.&quot;</span>, <span class="at">width =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb307-7"><a href="03-dplyr.html#cb307-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()<span class="sc">+</span> </span>
<span id="cb307-8"><a href="03-dplyr.html#cb307-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">annotation_logticks</span>(<span class="at">sides=</span><span class="st">&quot;l&quot;</span>)<span class="sc">+</span> <span class="co">#对数刻度</span></span>
<span id="cb307-9"><a href="03-dplyr.html#cb307-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,</span>
<span id="cb307-10"><a href="03-dplyr.html#cb307-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="fu">expression</span>(<span class="st">&quot;Cd concentration (&quot;</span><span class="sc">*</span>mu<span class="sc">*</span>g<span class="sc">~</span>g<span class="sc">^</span><span class="st">&quot;-1&quot;</span><span class="sc">*</span><span class="st">&quot;dry wt.)&quot;</span>),</span>
<span id="cb307-11"><a href="03-dplyr.html#cb307-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">color=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb307-12"><a href="03-dplyr.html#cb307-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;italic&quot;</span>, <span class="at">angle=</span><span class="dv">20</span>, <span class="at">hjust=</span><span class="dv">1</span>))<span class="sc">+</span> <span class="co">#x轴斜体，转角</span></span>
<span id="cb307-13"><a href="03-dplyr.html#cb307-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb307-14"><a href="03-dplyr.html#cb307-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb307-15"><a href="03-dplyr.html#cb307-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb307-16"><a href="03-dplyr.html#cb307-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>())<span class="sc">+</span> <span class="co">#调整图例位置、背景</span></span>
<span id="cb307-17"><a href="03-dplyr.html#cb307-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span> <span class="co">#去掉次要网格</span></span>
<span id="cb307-18"><a href="03-dplyr.html#cb307-18" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_color_viridis_d</span>(<span class="at">begin=</span><span class="dv">0</span>, <span class="at">end=</span><span class="fl">0.6</span>) <span class="co">#颜色选择，色盲友好</span></span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis
## Transformation introduced infinite values in continuous y-axis</code></pre>
<pre><code>## Warning: Removed 5 rows containing non-finite values (stat_ydensity).</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_point).</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-165-1.png" width="672" /></p>
<p>问题1得到回答了吗？</p>
<p>###汇总：把数据整理和画图的全部操作串联</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="03-dplyr.html#cb311-1" aria-hidden="true" tabindex="-1"></a>d0 <span class="sc">%&gt;%</span></span>
<span id="cb311-2"><a href="03-dplyr.html#cb311-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Fiscal_Year, Matrix, Scientific_Name, Parameter, Value, Unit) <span class="sc">%&gt;%</span></span>
<span id="cb311-3"><a href="03-dplyr.html#cb311-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Matrix <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Oyster&quot;</span>, <span class="st">&quot;Mussel&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb311-4"><a href="03-dplyr.html#cb311-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">&quot;Cadmium&quot;</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb311-5"><a href="03-dplyr.html#cb311-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Scientific_Name <span class="sc">!=</span> <span class="st">&quot;Crassostrea gigas&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb311-6"><a href="03-dplyr.html#cb311-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(Scientific_Name, <span class="sc">-</span>Value, median), Value, <span class="at">color=</span>Matrix))<span class="sc">+</span> <span class="co">#注意这步，省略了data指定，默认使用上游输送来的数据</span></span>
<span id="cb311-7"><a href="03-dplyr.html#cb311-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb311-8"><a href="03-dplyr.html#cb311-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_violin</span>(<span class="at">draw_quantiles =</span> <span class="fl">0.5</span>)<span class="sc">+</span> <span class="co">#小提琴图</span></span>
<span id="cb311-9"><a href="03-dplyr.html#cb311-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_beeswarm(cex = 0.4, shape = &quot;.&quot;, size = 3, alpha = 0.5)+ #蜂群图</span></span>
<span id="cb311-10"><a href="03-dplyr.html#cb311-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>()<span class="sc">+</span> </span>
<span id="cb311-11"><a href="03-dplyr.html#cb311-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_logticks</span>(<span class="at">sides=</span><span class="st">&quot;l&quot;</span>)<span class="sc">+</span> <span class="co">#对数刻度</span></span>
<span id="cb311-12"><a href="03-dplyr.html#cb311-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>,</span>
<span id="cb311-13"><a href="03-dplyr.html#cb311-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="fu">expression</span>(<span class="st">&quot;Cd concentration (&quot;</span><span class="sc">*</span>mu<span class="sc">*</span>g<span class="sc">~</span>g<span class="sc">^</span><span class="st">&quot;-1&quot;</span><span class="sc">*</span><span class="st">&quot;dry wt.)&quot;</span>),</span>
<span id="cb311-14"><a href="03-dplyr.html#cb311-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">color=</span><span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb311-15"><a href="03-dplyr.html#cb311-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;italic&quot;</span>, <span class="at">angle=</span><span class="dv">20</span>, <span class="at">hjust=</span><span class="dv">1</span>))<span class="sc">+</span> <span class="co">#x轴斜体，转角</span></span>
<span id="cb311-16"><a href="03-dplyr.html#cb311-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb311-17"><a href="03-dplyr.html#cb311-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb311-18"><a href="03-dplyr.html#cb311-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb311-19"><a href="03-dplyr.html#cb311-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key =</span> <span class="fu">element_blank</span>())<span class="sc">+</span> <span class="co">#调整图例位置、背景</span></span>
<span id="cb311-20"><a href="03-dplyr.html#cb311-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span> <span class="co">#去掉次要网格</span></span>
<span id="cb311-21"><a href="03-dplyr.html#cb311-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">begin=</span><span class="dv">0</span>, <span class="at">end=</span><span class="fl">0.6</span>) <span class="co">#颜色选择，色盲友好  </span></span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<pre><code>## Warning: Removed 5 rows containing non-finite values (stat_ydensity).</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-166-1.png" width="672" /></p>
</div>
</div>
<div id="用group_by和summarise分组计算均值标准差" class="section level2 hasAnchor" number="2.42">
<h2><span class="header-section-number">2.42</span> 用<code>group_by</code>和<code>summarise</code>分组计算均值、标准差<a href="03-dplyr.html#用group_by和summarise分组计算均值标准差" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>按物种名（<code>Scientific_Name</code>）分组，计算浓度（<code>Value</code>）的均值（<code>mean</code>）和标准差（<code>sd</code>）</li>
</ul>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="03-dplyr.html#cb314-1" aria-hidden="true" tabindex="-1"></a>d_Cd_mean <span class="ot">&lt;-</span>  d_Cd <span class="sc">%&gt;%</span></span>
<span id="cb314-2"><a href="03-dplyr.html#cb314-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Scientific_Name) <span class="sc">%&gt;%</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb314-3"><a href="03-dplyr.html#cb314-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Value), <span class="at">sd =</span> <span class="fu">sd</span>(Value)) <span class="co">#&lt;&lt;</span></span></code></pre></div>
<p>–</p>
<ul>
<li>查看计算结果</li>
</ul>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="03-dplyr.html#cb315-1" aria-hidden="true" tabindex="-1"></a>d_Cd_mean</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   Scientific_Name          mean    sd
##   &lt;fct&gt;                   &lt;dbl&gt; &lt;dbl&gt;
## 1 Mytilus species         3.61  2.37 
## 2 Crassostrea virginica   3.65  2.81 
## 3 Mytilus edulis          1.69  1.52 
## 4 Geukensia demissa       0.980 0.765
## 5 Ostrea sandvicensis     0.625 0.475
## 6 Crassostrea rhizophorae 0.527 0.237</code></pre>
<ul>
<li>以上结果可用于作图，也可用于表格</li>
</ul>
</div>
<div id="研究问题2" class="section level2 hasAnchor" number="2.43">
<h2><span class="header-section-number">2.43</span> 研究问题2：<a href="03-dplyr.html#研究问题2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="zn浓度高的牡蛎是否cd浓度也高" class="section level3 hasAnchor" number="2.43.1">
<h3><span class="header-section-number">2.43.1</span> Zn浓度高的牡蛎，是否Cd浓度也高？<a href="03-dplyr.html#zn浓度高的牡蛎是否cd浓度也高" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>再来观察数据</li>
<li><code>Sample_ID</code>可以作为样品配对的依据</li>
</ul>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="03-dplyr.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d0)</span></code></pre></div>
<pre><code>##  [1] &quot;Study&quot;             &quot;NST_Site&quot;          &quot;General_Location&quot; 
##  [4] &quot;Specific_Location&quot; &quot;Sample_ID&quot;         &quot;Latitude&quot;         
##  [7] &quot;Longitude&quot;         &quot;Fiscal_Year&quot;       &quot;Collection_Date&quot;  
## [10] &quot;Matrix&quot;            &quot;Scientific_Name&quot;   &quot;Method&quot;           
## [13] &quot;Parameter&quot;         &quot;Value&quot;             &quot;Qualifier&quot;        
## [16] &quot;Unit&quot;</code></pre>
</div>
<div id="整理数据" class="section level3 hasAnchor" number="2.43.2">
<h3><span class="header-section-number">2.43.2</span> 整理数据<a href="03-dplyr.html#整理数据" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>选择这些列：<code>Sample_ID</code>, <code>Fiscal_Year</code>, <code>Matrix</code>, <code>Scientific_Name</code>, <code>Parameter</code>, <code>Value</code>, <code>Unit</code><br />
</li>
<li>筛选出<code>Oyster</code>的数据<br />
</li>
<li>筛选出<code>Cadmium</code>和<code>Zinc</code>的数据<br />
</li>
<li>删去物种<em><code>Crassostrea gigas</code></em>的数据（只有两条数据，缺乏代表性）</li>
</ol>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="03-dplyr.html#cb319-1" aria-hidden="true" tabindex="-1"></a>d_oy_Cd.Zn <span class="ot">&lt;-</span> d0 <span class="sc">%&gt;%</span></span>
<span id="cb319-2"><a href="03-dplyr.html#cb319-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sample_ID,</span>
<span id="cb319-3"><a href="03-dplyr.html#cb319-3" aria-hidden="true" tabindex="-1"></a>         Fiscal_Year,</span>
<span id="cb319-4"><a href="03-dplyr.html#cb319-4" aria-hidden="true" tabindex="-1"></a>         Matrix,</span>
<span id="cb319-5"><a href="03-dplyr.html#cb319-5" aria-hidden="true" tabindex="-1"></a>         Scientific_Name,</span>
<span id="cb319-6"><a href="03-dplyr.html#cb319-6" aria-hidden="true" tabindex="-1"></a>         Parameter,</span>
<span id="cb319-7"><a href="03-dplyr.html#cb319-7" aria-hidden="true" tabindex="-1"></a>         Value,</span>
<span id="cb319-8"><a href="03-dplyr.html#cb319-8" aria-hidden="true" tabindex="-1"></a>         Unit) <span class="sc">%&gt;%</span></span>
<span id="cb319-9"><a href="03-dplyr.html#cb319-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Matrix <span class="sc">==</span> <span class="st">&quot;Oyster&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb319-10"><a href="03-dplyr.html#cb319-10" aria-hidden="true" tabindex="-1"></a>      Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Cadmium&quot;</span>, <span class="st">&quot;Zinc&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb319-11"><a href="03-dplyr.html#cb319-11" aria-hidden="true" tabindex="-1"></a>      Scientific_Name <span class="sc">!=</span> <span class="st">&quot;Crassostrea gigas&quot;</span>) </span></code></pre></div>
</div>
<div id="查看整理好的数据" class="section level3 hasAnchor" number="2.43.3">
<h3><span class="header-section-number">2.43.3</span> 查看整理好的数据<a href="03-dplyr.html#查看整理好的数据" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>有哪些列？</li>
</ul>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="03-dplyr.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d_oy_Cd.Zn)</span></code></pre></div>
<pre><code>## [1] &quot;Sample_ID&quot;       &quot;Fiscal_Year&quot;     &quot;Matrix&quot;          &quot;Scientific_Name&quot;
## [5] &quot;Parameter&quot;       &quot;Value&quot;           &quot;Unit&quot;</code></pre>
<ul>
<li>测定了哪些污染物？</li>
</ul>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="03-dplyr.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(d_oy_Cd.Zn<span class="sc">$</span>Parameter)</span></code></pre></div>
<pre><code>## [1] &quot;Cadmium&quot; &quot;Zinc&quot;</code></pre>
</div>
<div id="把数据切分成cd数据zn数据" class="section level3 hasAnchor" number="2.43.4">
<h3><span class="header-section-number">2.43.4</span> 把数据切分成<code>Cd</code>数据、<code>Zn</code>数据<a href="03-dplyr.html#把数据切分成cd数据zn数据" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>用<code>subset()</code>切出<code>Cd</code>的数据</li>
</ul>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="03-dplyr.html#cb324-1" aria-hidden="true" tabindex="-1"></a>d_oy_Cd <span class="ot">&lt;-</span> <span class="fu">subset</span>(d_oy_Cd.Zn, Parameter<span class="sc">==</span><span class="st">&quot;Cadmium&quot;</span>)</span>
<span id="cb324-2"><a href="03-dplyr.html#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(d_oy_Cd) <span class="co"># 1718条数据</span></span></code></pre></div>
<pre><code>## [1] 1718    7</code></pre>
<ul>
<li>用<code>subset()</code>切出<code>Zn</code>的数据</li>
</ul>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="03-dplyr.html#cb326-1" aria-hidden="true" tabindex="-1"></a>d_oy_Zn <span class="ot">&lt;-</span> <span class="fu">subset</span>(d_oy_Cd.Zn, Parameter<span class="sc">==</span><span class="st">&quot;Zinc&quot;</span>)</span>
<span id="cb326-2"><a href="03-dplyr.html#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(d_oy_Zn) <span class="co"># 也是1718条数据</span></span></code></pre></div>
<pre><code>## [1] 1718    7</code></pre>
<p><br></p>
<p>两种金属的数据都是1718条，很可能是一一对应的。这需要一一核对两组数据的<code>Sample_ID</code>才能确定，那是很大的工作量。这种情况下，<code>join</code>系列函数就派上用场了。</p>
</div>
<div id="运用inner_join合并两套数据" class="section level3 hasAnchor" number="2.43.5">
<h3><span class="header-section-number">2.43.5</span> 运用<code>inner_join()</code>合并两套数据<a href="03-dplyr.html#运用inner_join合并两套数据" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>当两组数据的<code>Sample_ID</code>相同时，则合并在同一行</li>
</ul>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="03-dplyr.html#cb328-1" aria-hidden="true" tabindex="-1"></a>d_oy <span class="ot">&lt;-</span></span>
<span id="cb328-2"><a href="03-dplyr.html#cb328-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(d_oy_Cd,</span>
<span id="cb328-3"><a href="03-dplyr.html#cb328-3" aria-hidden="true" tabindex="-1"></a>             d_oy_Zn,</span>
<span id="cb328-4"><a href="03-dplyr.html#cb328-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">&quot;Sample_ID&quot;</span>, </span>
<span id="cb328-5"><a href="03-dplyr.html#cb328-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;.Cd&quot;</span>, <span class="st">&quot;.Zn&quot;</span>))</span></code></pre></div>
<ul>
<li>查看一下数据, 还是1718列，1个也没丢失，说明两组数据确实一一对应</li>
</ul>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="03-dplyr.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(d_oy)  </span></code></pre></div>
<pre><code>## [1] 1718   13</code></pre>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="03-dplyr.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d_oy)</span></code></pre></div>
<pre><code>##  [1] &quot;Sample_ID&quot;          &quot;Fiscal_Year.Cd&quot;     &quot;Matrix.Cd&quot;         
##  [4] &quot;Scientific_Name.Cd&quot; &quot;Parameter.Cd&quot;       &quot;Value.Cd&quot;          
##  [7] &quot;Unit.Cd&quot;            &quot;Fiscal_Year.Zn&quot;     &quot;Matrix.Zn&quot;         
## [10] &quot;Scientific_Name.Zn&quot; &quot;Parameter.Zn&quot;       &quot;Value.Zn&quot;          
## [13] &quot;Unit.Zn&quot;</code></pre>
</div>
<div id="join系列函数" class="section level3 hasAnchor" number="2.43.6">
<h3><span class="header-section-number">2.43.6</span> <code>join</code>系列函数<a href="03-dplyr.html#join系列函数" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p><code>inner_join()</code><br />
return all rows from x where there are matching values in y, and all columns from x and y. If there are multiple matches between x and y, all combination of the matches are returned.</p></li>
<li><p><code>left_join()</code><br />
return all rows from x, and all columns from x and y. Rows in x with no match in y will have NA values in the new columns. If there are multiple matches between x and y, all combinations of the matches are returned.</p></li>
<li><p><code>right_join()</code><br />
return all rows from y, and all columns from x and y. Rows in y with no match in x will have NA values in the new columns. If there are multiple matches between x and y, all combinations of the matches are returned.<br />
<br></p></li>
<li><p><code>full_join()</code><br />
return all rows and all columns from both x and y. Where there are not matching values, returns NA for the one missing.<br />
<br>
阅读： <a href="https://dplyr.tidyverse.org/reference/join.html" class="uri">https://dplyr.tidyverse.org/reference/join.html</a></p></li>
</ul>
</div>
<div id="作散点图初步了解数据" class="section level3 hasAnchor" number="2.43.7">
<h3><span class="header-section-number">2.43.7</span> 作散点图初步了解数据<a href="03-dplyr.html#作散点图初步了解数据" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="03-dplyr.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_oy, <span class="fu">aes</span>(Value.Cd, Value.Zn))<span class="sc">+</span></span>
<span id="cb333-2"><a href="03-dplyr.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-177-1.png" width="672" /></p>
</div>
<div id="使用双对数坐标" class="section level3 hasAnchor" number="2.43.8">
<h3><span class="header-section-number">2.43.8</span> 使用双对数坐标<a href="03-dplyr.html#使用双对数坐标" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="03-dplyr.html#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_oy, <span class="fu">aes</span>(Value.Cd, Value.Zn))<span class="sc">+</span></span>
<span id="cb334-2"><a href="03-dplyr.html#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb334-3"><a href="03-dplyr.html#cb334-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_x_log10</span>()<span class="sc">+</span></span>
<span id="cb334-4"><a href="03-dplyr.html#cb334-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_y_log10</span>()</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-178-1.png" width="672" /></p>
<ul>
<li>原始数据里有“0”值，取对数后产生负无穷大（-Inf）.作图时会产生警告信息，但不妨碍出图。在坐标轴上可以看到这些点，他们露出了一半。</li>
</ul>
</div>
<div id="按不同物种分面作图" class="section level3 hasAnchor" number="2.43.9">
<h3><span class="header-section-number">2.43.9</span> 按不同物种分面作图<a href="03-dplyr.html#按不同物种分面作图" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="03-dplyr.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_oy, <span class="fu">aes</span>(Value.Cd, Value.Zn))<span class="sc">+</span></span>
<span id="cb336-2"><a href="03-dplyr.html#cb336-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb336-3"><a href="03-dplyr.html#cb336-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()<span class="sc">+</span></span>
<span id="cb336-4"><a href="03-dplyr.html#cb336-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()<span class="sc">+</span></span>
<span id="cb336-5"><a href="03-dplyr.html#cb336-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Scientific_Name.Zn) <span class="co"># 用Scientific_Name.Cd也一样</span></span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-179-1.png" width="672" />
- 大部分数据都是关于<em>Crassostrea virginica</em>这种牡蛎的</p>
</div>
<div id="添加拟合线帮助判断趋势" class="section level3 hasAnchor" number="2.43.10">
<h3><span class="header-section-number">2.43.10</span> 添加拟合线，帮助判断趋势<a href="03-dplyr.html#添加拟合线帮助判断趋势" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="03-dplyr.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_oy, <span class="fu">aes</span>(Value.Cd, Value.Zn))<span class="sc">+</span></span>
<span id="cb338-2"><a href="03-dplyr.html#cb338-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb338-3"><a href="03-dplyr.html#cb338-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()<span class="sc">+</span></span>
<span id="cb338-4"><a href="03-dplyr.html#cb338-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()<span class="sc">+</span></span>
<span id="cb338-5"><a href="03-dplyr.html#cb338-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Scientific_Name.Zn)<span class="sc">+</span></span>
<span id="cb338-6"><a href="03-dplyr.html#cb338-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis
## Transformation introduced infinite values in continuous x-axis</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 3 rows containing non-finite values (stat_smooth).</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-180-1.png" width="672" />
- 大部分数据都是关于<em>Crassostrea virginica</em>这种牡蛎的</p>
</div>
<div id="美化一下" class="section level3 hasAnchor" number="2.43.11">
<h3><span class="header-section-number">2.43.11</span> 美化一下<a href="03-dplyr.html#美化一下" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="03-dplyr.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_oy, <span class="fu">aes</span>(Value.Cd, Value.Zn, <span class="at">color=</span> Scientific_Name.Zn))<span class="sc">+</span></span>
<span id="cb342-2"><a href="03-dplyr.html#cb342-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb342-3"><a href="03-dplyr.html#cb342-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">16</span>, <span class="at">size=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb342-4"><a href="03-dplyr.html#cb342-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>()<span class="sc">+</span></span>
<span id="cb342-5"><a href="03-dplyr.html#cb342-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>()<span class="sc">+</span></span>
<span id="cb342-6"><a href="03-dplyr.html#cb342-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_logticks</span>(<span class="at">sides=</span><span class="st">&quot;bl&quot;</span>)<span class="sc">+</span></span>
<span id="cb342-7"><a href="03-dplyr.html#cb342-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Scientific_Name.Zn)<span class="sc">+</span></span>
<span id="cb342-8"><a href="03-dplyr.html#cb342-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb342-9"><a href="03-dplyr.html#cb342-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">expression</span>(<span class="st">&quot;Cd concentration (&quot;</span><span class="sc">*</span>mu<span class="sc">*</span>g<span class="sc">~</span>g<span class="sc">^</span><span class="st">&quot;-1&quot;</span><span class="sc">*</span><span class="st">&quot;)&quot;</span>),</span>
<span id="cb342-10"><a href="03-dplyr.html#cb342-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="fu">expression</span>(<span class="st">&quot;Zn concentration (&quot;</span><span class="sc">*</span>mu<span class="sc">*</span>g<span class="sc">~</span>g<span class="sc">^</span><span class="st">&quot;-1&quot;</span><span class="sc">*</span><span class="st">&quot;)&quot;</span>))<span class="sc">+</span></span>
<span id="cb342-11"><a href="03-dplyr.html#cb342-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color=</span><span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb342-12"><a href="03-dplyr.html#cb342-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;italic&quot;</span>))<span class="sc">+</span> <span class="co">#横幅上物种名用斜体</span></span>
<span id="cb342-13"><a href="03-dplyr.html#cb342-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">end=</span><span class="fl">0.6</span>)</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis
## Transformation introduced infinite values in continuous x-axis</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 3 rows containing non-finite values (stat_smooth).</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-181-1.png" width="672" /></p>
</div>
<div id="成品" class="section level3 hasAnchor" number="2.43.12">
<h3><span class="header-section-number">2.43.12</span> 成品<a href="03-dplyr.html#成品" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>问题2得到回答了吗？</p>
</div>
</div>
<div id="要点小结-1" class="section level2 hasAnchor" number="2.44">
<h2><span class="header-section-number">2.44</span> 要点小结<a href="03-dplyr.html#要点小结-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<thead>
<tr class="header">
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>fliter()</code></td>
<td>根据其值筛选行</td>
</tr>
<tr class="even">
<td><code>select()</code></td>
<td>根据其名筛选列</td>
</tr>
<tr class="odd">
<td><code>arrange()</code></td>
<td>改变行的排序，从低到高排</td>
</tr>
<tr class="even">
<td><code>arrange(desc())</code></td>
<td>… 从高到低排</td>
</tr>
<tr class="odd">
<td><code>mutate()</code></td>
<td>基于现有变量进行计算，增加新的变量（类比excel里的C1=A1*B1)</td>
</tr>
<tr class="even">
<td><code>summarize()</code></td>
<td>计算统计量（如均值、方差、中位数）</td>
</tr>
<tr class="odd">
<td><code>pivot_longer()</code></td>
<td>宽数据变长数据</td>
</tr>
<tr class="even">
<td><code>pivot_wider()</code></td>
<td>长数据变宽数据</td>
</tr>
<tr class="odd">
<td><code>melt()</code></td>
<td>宽数据变长数据</td>
</tr>
<tr class="even">
<td><code>left_join()</code></td>
<td>合并数据，保留左侧全部的，右侧没有对应值的则填充NA</td>
</tr>
<tr class="odd">
<td><code>inner_join()</code></td>
<td>合并数据，保留共有的</td>
</tr>
<tr class="even">
<td>…</td>
<td>….</td>
</tr>
</tbody>
</table>
</div>
<div id="要点小结-2" class="section level2 hasAnchor" number="2.45">
<h2><span class="header-section-number">2.45</span> 要点小结<a href="03-dplyr.html#要点小结-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="运算符" class="section level3 hasAnchor" number="2.45.1">
<h3><span class="header-section-number">2.45.1</span> “<code>%&gt;%</code>”运算符<a href="03-dplyr.html#运算符" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>读作pipe，可以翻译成管道（很形象）<br />
</li>
<li>pipe将多个操作串联起来，上一操作的结果成为下一操作的对象<br />
</li>
<li>功能类似<code>ggplot</code>里的”<code>+</code>“号</li>
</ul>
</div>
</div>
<div id="练习" class="section level2 hasAnchor" number="2.46">
<h2><span class="header-section-number">2.46</span> 练习<a href="03-dplyr.html#练习" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>分析不同年份贻贝的Cu浓度，看看有何趋势？</li>
<li>自己观察数据，提出问题，并通过数据分析去回答。</li>
</ol>
</div>
<div id="阅读" class="section level2 hasAnchor" number="2.47">
<h2><span class="header-section-number">2.47</span> 阅读：<a href="03-dplyr.html#阅读" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Overview of dplyr
<a href="https://dplyr.tidyverse.org/index.html" class="uri">https://dplyr.tidyverse.org/index.html</a></p></li>
<li><p>Introduction to dplyr
<a href="https://dplyr.tidyverse.org/articles/dplyr.html" class="uri">https://dplyr.tidyverse.org/articles/dplyr.html</a></p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="01-intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="04-lubridate.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/tan-qiao-guo/EnvDAV/edit/master/03-dplyr.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/tan-qiao-guo/EnvDAV/blod/master/03-dplyr.Rmd",
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
